<!doctype html>
<html lang="de" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <title>BALKO ‚Äì Marktplatz</title>
  
  <style>
    /* --- iOS DESIGN SYSTEM --- */
    :root {
      /* LIGHT MODE */
      --bg-body: #F2F2F7;       
      --bg-card: #FFFFFF;
      --bg-input: #E5E5EA;      
      --text-primary: #000000;
      --text-secondary: #8E8E93;
      --separator: #C6C6C8;     
      --accent: #007AFF;        
      --danger: #FF3B30;        
      --success: #34C759;       
      
      --radius-l: 24px;         
      --radius-m: 16px;         
      
      --shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      --font: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      
      --nav-height: 60px;
      --max-width: 800px; /* Optimal f√ºr App-Feeling */
    }

    [data-theme="dark"] {
      /* DARK MODE */
      --bg-body: #000000;
      --bg-card: #1C1C1E;       
      --bg-input: #2C2C2E;
      --text-primary: #FFFFFF;
      --text-secondary: #98989D;
      --separator: #38383A;
      --accent: #0A84FF;
      --shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    
    body {
      background-color: var(--bg-body);
      color: var(--text-primary);
      font-family: var(--font);
      -webkit-font-smoothing: antialiased;
      padding-bottom: 120px; /* Mehr Platz f√ºr das Floating Dock */
      padding-top: env(safe-area-inset-top);
      transition: background-color 0.3s ease;
    }

    button, input, select, textarea { font-family: inherit; border: none; outline: none; }
    a { text-decoration: none; color: inherit; cursor: pointer; }
    .wrap { max-width: var(--max-width); margin: 0 auto; padding: 0 20px; }
    .hidden { display: none !important; }

    /* --- CLEAN HEADER (No Links) --- */
    .navbar {
      position: sticky; top: 0; z-index: 1000;
      height: var(--nav-height);
      background: rgba(255, 255, 255, 0.0); /* Transparent f√ºr Glass effekt */
      /* Backdrop-Filter entfernt f√ºr cleaner Look oben, content scrollt drunter */
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 10px;
    }
    
    .nav-inner { 
      width: 100%; display: flex; justify-content: space-between; align-items: center; 
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      padding: 10px 20px; border-radius: 0 0 24px 24px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    [data-theme="dark"] .nav-inner { background: rgba(28, 28, 30, 0.85); }

    .logo { font-weight: 800; font-size: 24px; letter-spacing: -1px; color: var(--text-primary); }
    .logo span { color: var(--accent); }

    .nav-controls { display: flex; gap: 12px; align-items: center; }

    .lang-select {
      background: var(--bg-input); color: var(--text-primary);
      font-size: 13px; font-weight: 700; padding: 0 12px; height: 36px;
      border-radius: 18px; cursor: pointer; appearance: none;
      text-align: center; border: 1px solid transparent;
      transition: 0.2s;
    }
    
    .theme-toggle {
      width: 36px; height: 36px; border-radius: 50%;
      background: var(--bg-input); color: var(--text-primary);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; font-size: 18px; transition: 0.2s;
    }
    .theme-toggle:active { transform: scale(0.9); }

    /* --- COMPONENTS --- */
    .ios-input-group { margin-bottom: 20px; }
    .ios-label {
      display: block; font-size: 11px; text-transform: uppercase; font-weight: 700;
      color: var(--text-secondary); margin-bottom: 8px; margin-left: 12px; letter-spacing: 0.5px;
    }
    .ios-input {
      width: 100%; height: 54px; padding: 0 16px;
      background: var(--bg-card); color: var(--text-primary);
      border-radius: var(--radius-m); font-size: 17px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.02);
      transition: 0.2s;
    }
    .ios-input:focus { box-shadow: 0 0 0 2px var(--accent); transform: scale(1.01); }
    textarea.ios-input { height: auto; padding-top: 16px; min-height: 140px; resize: none; }
    
    select.ios-input {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%238E8E93' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat; background-position: right 16px center; background-size: 18px;
    }

    .ios-card {
      background: var(--bg-card); border-radius: var(--radius-l);
      padding: 24px; box-shadow: var(--shadow); margin-bottom: 24px;
      position: relative; overflow: hidden;
    }

    .ios-btn {
      width: 100%; height: 56px;
      background: var(--accent); color: #fff;
      font-size: 17px; font-weight: 700;
      border-radius: 28px; /* Pill Shape */
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: transform 0.1s, opacity 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
    }
    .ios-btn:active { transform: scale(0.96); opacity: 0.9; }
    .ios-btn.secondary { 
      background: var(--bg-input); color: var(--text-primary); box-shadow: none; 
    }

    /* --- LAYOUTS --- */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    @media (max-width: 600px) { .grid-4 { grid-template-columns: 1fr 1fr; } }

    /* --- VIEW: MARKET --- */
    .market-header { margin: 20px 0 30px 0; text-align: left; padding: 0 10px; }
    .market-title { font-size: 34px; font-weight: 800; margin-bottom: 4px; letter-spacing: -1px; }
    .market-subtitle { color: var(--text-secondary); font-size: 17px; font-weight: 500; }

    .search-wrapper { position: relative; margin-bottom: 24px; }
    .search-input { background: var(--bg-card); border-radius: 20px; padding-left: 50px; height: 60px; font-size: 18px; }
    .search-icon { position: absolute; left: 18px; top: 20px; color: var(--accent); font-size: 20px; }

    .adv-filter-box {
      margin-top: 16px; padding: 20px; background: var(--bg-card); border: 1px solid var(--accent);
      border-radius: var(--radius-m); display: none; box-shadow: var(--shadow);
    }
    .adv-filter-box.show { display: block; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes popIn { from{opacity:0; transform:scale(0.95)} to{opacity:1; transform:scale(1)} }

    .listing-grid {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 30px;
    }
    @media (min-width: 600px) { .listing-grid { grid-template-columns: repeat(3, 1fr); } }

    .empty-state {
      grid-column: 1 / -1; padding: 60px 0; text-align: center; color: var(--text-secondary);
    }
    .empty-icon { font-size: 60px; margin-bottom: 16px; opacity: 0.2; filter: grayscale(1); }

    /* --- VIEW: SELL --- */
    .upload-box {
      aspect-ratio: 1; background: var(--bg-input); border-radius: var(--radius-m);
      display: flex; align-items: center; justify-content: center;
      font-size: 28px; color: var(--text-secondary); cursor: pointer; transition: 0.2s;
    }
    .upload-box:active { transform: scale(0.95); }
    .upload-box.main { 
      border: 2px dashed var(--accent); color: var(--accent); background: rgba(0, 122, 255, 0.05); 
    }

    /* --- VIEW: PROFILE --- */
    .profile-header { text-align: center; padding: 30px 0; }
    .avatar-circle {
      width: 110px; height: 110px; border-radius: 50%;
      background: var(--bg-input); margin: 0 auto 16px;
      display: flex; align-items: center; justify-content: center;
      font-size: 50px; border: 4px solid var(--bg-card);
      box-shadow: var(--shadow);
    }
    .list-group {
      background: var(--bg-card); border-radius: var(--radius-l); overflow: hidden; margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.03);
    }
    .list-item {
      padding: 18px 24px; border-bottom: 0.5px solid var(--separator);
      display: flex; align-items: center; justify-content: space-between; cursor: pointer; font-size: 16px; font-weight: 500;
      transition: background 0.1s;
    }
    .list-item:last-child { border-bottom: none; }
    .list-item:active { background: var(--bg-input); }
    .list-icon { margin-right: 16px; width: 24px; text-align: center; font-size: 18px; }
    .chevron { color: var(--text-secondary); font-size: 14px; font-weight: 700; opacity: 0.5; }

    /* --- FLOATING DOCK (Touch Design) --- */
    .tab-bar-container {
      position: fixed; bottom: 30px; left: 0; right: 0; z-index: 2000;
      display: flex; justify-content: center; pointer-events: none; /* Container click-through */
    }

    .tab-bar {
      pointer-events: auto;
      height: 70px; 
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
      border-radius: 35px; /* Full Rounded Pill */
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 10px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      border: 1px solid rgba(255,255,255,0.2);
      min-width: 280px;
    }
    [data-theme="dark"] .tab-bar { 
      background: rgba(40, 40, 42, 0.85); border-color: rgba(255,255,255,0.1); 
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }

    .tab-item {
      width: 60px; height: 60px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      color: var(--text-secondary); cursor: pointer; border-radius: 50%;
      transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .tab-icon { font-size: 26px; margin-bottom: 0; transition: transform 0.2s; }
    
    .tab-item.active { 
      color: #fff; background: var(--accent); 
      transform: translateY(-10px) scale(1.1);
      box-shadow: 0 6px 15px rgba(0, 122, 255, 0.4);
    }
    .tab-item:active { transform: scale(0.9); }

  </style>
</head>
<body>

  <nav class="navbar">
    <div class="wrap nav-inner">
      <div class="logo" onclick="app.nav('market')">BALKO<span>.</span></div>
      
      <div class="nav-controls">
        <select class="lang-select" id="lang-switcher" onchange="app.setLanguage(this.value)">
          <option value="de">DE</option>
          <option value="en">EN</option>
          <option value="sq">SQ</option>
          <option value="sr">SR</option>
          <option value="mk">MK</option>
        </select>
        
        <div class="theme-toggle" onclick="app.toggleTheme()">
          <span id="theme-icon">üåô</span>
        </div>
      </div>
    </div>
  </nav>

  <main class="wrap">
    
    <section id="view-market">
      <div class="market-header">
        <div class="market-title" data-i18n="market_title">Entdecken</div>
        <div class="market-subtitle" data-i18n="market_subtitle">Finde Angebote im Balkan</div>
      </div>

      <div class="search-wrapper">
        <span class="search-icon">üîç</span>
        <input type="text" class="ios-input search-input" id="search-input" placeholder="" data-i18n-placeholder="search_ph">
      </div>

      <div class="grid-2" style="margin-bottom: 16px;">
        <div class="ios-input-group" style="margin:0;">
          <label class="ios-label" data-i18n="label_country">Land</label>
          <select class="ios-input" id="filter-country"></select>
        </div>
        <div class="ios-input-group" style="margin:0;">
          <label class="ios-label" data-i18n="label_category">Kategorie</label>
          <select class="ios-input" id="filter-cat"></select>
        </div>
      </div>

      <div class="grid-2">
        <div class="ios-input-group" style="margin:0;">
          <label class="ios-label" data-i18n="label_region">Region / Stadt</label>
          <input type="text" class="ios-input" placeholder="" data-i18n-placeholder="region_ph">
        </div>
        <div class="ios-input-group" style="margin:0;">
          <label class="ios-label" data-i18n="label_subcategory">Unterkategorie</label>
          <select class="ios-input" id="filter-sub" disabled>
            <option data-i18n="opt_all">Alle</option>
          </select>
        </div>
      </div>

      <div id="dynamic-filters" class="adv-filter-box"></div>

      <div class="listing-grid">
        <div class="empty-state">
          <div class="empty-icon">üõí</div>
          <div data-i18n="empty_results">Hier ist es leer.<br><small>Starte eine Suche.</small></div>
        </div>
      </div>
    </section>

    <section id="view-sell" class="hidden">
      <div class="market-header">
        <div class="market-title" data-i18n="nav_sell">Verkaufen</div>
        <div class="market-subtitle" data-i18n="sell_subtitle">Inserat aufgeben</div>
      </div>

      <div class="ios-card">
        <div class="ios-label" style="margin-bottom:12px;" data-i18n="label_photos">Fotos (Max 8)</div>
        <div class="grid-4">
          <div class="upload-box main">üì∑</div>
          <div class="upload-box">+</div>
          <div class="upload-box">+</div>
          <div class="upload-box">+</div>
          <div class="upload-box">+</div>
          <div class="upload-box">+</div>
          <div class="upload-box">+</div>
          <div class="upload-box">+</div>
        </div>
      </div>

      <div class="ios-card">
        <div class="ios-input-group">
          <label class="ios-label" data-i18n="label_title">Titel</label>
          <input type="text" class="ios-input" placeholder="" data-i18n-placeholder="title_ph">
        </div>

        <div class="grid-2">
           <div class="ios-input-group">
            <label class="ios-label" data-i18n="label_country">Land</label>
            <select class="ios-input" id="sell-country"></select>
          </div>
          <div class="ios-input-group">
            <label class="ios-label" data-i18n="label_price">Preis (‚Ç¨)</label>
            <input type="number" class="ios-input" placeholder="0">
          </div>
        </div>

        <div class="grid-2">
          <div class="ios-input-group">
            <label class="ios-label" data-i18n="label_category">Kategorie</label>
            <select class="ios-input" id="sell-cat"></select>
          </div>
          <div class="ios-input-group">
            <label class="ios-label" data-i18n="label_subcategory">Unterkategorie</label>
            <select class="ios-input" id="sell-sub" disabled>
              <option data-i18n="opt_choose">W√§hlen...</option>
            </select>
          </div>
        </div>

        <div id="sell-dynamic-inputs" class="grid-2" style="margin-bottom: 20px; display:none;"></div>

        <div class="ios-input-group">
          <label class="ios-label" data-i18n="label_description">Beschreibung</label>
          <textarea class="ios-input" placeholder="" data-i18n-placeholder="desc_ph"></textarea>
        </div>

        <button class="ios-btn" data-i18n="btn_publish">Ver√∂ffentlichen</button>
      </div>
    </section>

    <section id="view-profile" class="hidden">
      <div class="profile-header">
        <div class="avatar-circle">üë§</div>
        <div class="market-title" style="font-size:28px;" data-i18n="profile_title">Mein Profil</div>
        <div class="market-subtitle" data-i18n="profile_subtitle">Gast</div>
      </div>

      <div class="list-group">
        <div class="list-item">
          <div style="display:flex; align-items:center;">
            <span class="list-icon">üìù</span> <span data-i18n="menu_personal">Pers√∂nliche Daten</span>
          </div>
          <span class="chevron">‚Ä∫</span>
        </div>
        <div class="list-item">
          <div style="display:flex; align-items:center;">
            <span class="list-icon">üì¶</span> <span data-i18n="menu_listings">Meine Inserate</span>
          </div>
          <span class="chevron">‚Ä∫</span>
        </div>
        <div class="list-item">
          <div style="display:flex; align-items:center;">
            <span class="list-icon">üíñ</span> <span data-i18n="menu_watchlist">Merkliste</span>
          </div>
          <span class="chevron">‚Ä∫</span>
        </div>
      </div>

      <div class="list-group">
        <div class="list-item">
          <div style="display:flex; align-items:center;">
            <span class="list-icon">üîí</span> <span data-i18n="menu_security">Sicherheit</span>
          </div>
          <span class="chevron">‚Ä∫</span>
        </div>
      </div>

      <button class="ios-btn secondary" style="color:var(--danger);" data-i18n="btn_logout">Abmelden</button>
    </section>
  </main>

  <div class="tab-bar-container">
    <div class="tab-bar">
      <div class="tab-item active" id="tab-market" onclick="app.nav('market')">
        <div class="tab-icon">üîç</div>
      </div>
      <div class="tab-item" id="tab-sell" onclick="app.nav('sell')">
        <div class="tab-icon">‚ûï</div>
      </div>
      <div class="tab-item" id="tab-profile" onclick="app.nav('profile')">
        <div class="tab-icon">üë§</div>
      </div>
    </div>
  </div>

  <script>
    // --- TRANSLATION DATABASE ---
    const TRANSLATIONS = {
      de: {
        nav_market: "Markt", nav_sell: "Verkaufen", nav_profile: "Profil",
        market_title: "Entdecken", market_subtitle: "Finde Angebote im Balkan",
        sell_subtitle: "Inserat aufgeben",
        profile_title: "Mein Profil", profile_subtitle: "Gast",
        search_ph: "Suche (z.B. Golf 7, Wohnung)...",
        label_country: "Land", label_category: "Kategorie", label_region: "Region / Stadt",
        label_subcategory: "Unterkategorie", label_title: "Titel", label_price: "Preis (‚Ç¨)",
        label_description: "Beschreibung", label_photos: "Fotos (Max 8)",
        region_ph: "Ort eingeben", title_ph: "Was verkaufst du?", desc_ph: "Details zum Artikel...",
        btn_publish: "Ver√∂ffentlichen", btn_logout: "Abmelden",
        opt_all: "Alle", opt_choose: "W√§hlen...",
        menu_personal: "Pers√∂nliche Daten", menu_listings: "Meine Inserate", 
        menu_watchlist: "Merkliste", menu_security: "Sicherheit",
        empty_results: "Keine Ergebnisse.<br><small>W√§hle Filter um Angebote zu sehen.</small>",
        // Context Filters
        filter_km: "Kilometer bis", filter_year: "Erstzulassung ab", filter_power: "Leistung (PS)",
        filter_area: "Fl√§che (m¬≤)", filter_rooms: "Zimmer ab", filter_floor: "Etage"
      },
      en: {
        nav_market: "Market", nav_sell: "Sell", nav_profile: "Profile",
        market_title: "Discover", market_subtitle: "Find offers in the Balkans",
        sell_subtitle: "Post an ad",
        profile_title: "My Profile", profile_subtitle: "Guest",
        search_ph: "Search (e.g. Golf 7, Apartment)...",
        label_country: "Country", label_category: "Category", label_region: "Region / City",
        label_subcategory: "Subcategory", label_title: "Title", label_price: "Price (‚Ç¨)",
        label_description: "Description", label_photos: "Photos (Max 8)",
        region_ph: "Enter location", title_ph: "What are you selling?", desc_ph: "Item details...",
        btn_publish: "Publish", btn_logout: "Log out",
        opt_all: "All", opt_choose: "Choose...",
        menu_personal: "Personal Data", menu_listings: "My Listings", 
        menu_watchlist: "Watchlist", menu_security: "Security",
        empty_results: "No results.<br><small>Choose filters to see listings.</small>",
        filter_km: "Max Mileage", filter_year: "Min Year", filter_power: "Power (HP)",
        filter_area: "Min Area (m¬≤)", filter_rooms: "Min Rooms", filter_floor: "Floor"
      },
      sq: { 
        nav_market: "Tregu", nav_sell: "Shit", nav_profile: "Profili",
        market_title: "Zbulo", market_subtitle: "Gjej oferta n√´ Ballkan",
        sell_subtitle: "Posto njoftim",
        profile_title: "Profili Im", profile_subtitle: "Mysafir",
        search_ph: "K√´rko (p.sh. Golf 7, Banes√´)...",
        label_country: "Shteti", label_category: "Kategoria", label_region: "Rajoni / Qyteti",
        label_subcategory: "N√´nkategoria", label_title: "Titulli", label_price: "√ámimi (‚Ç¨)",
        label_description: "P√´rshkrimi", label_photos: "Fotot (Max 8)",
        region_ph: "Shkruaj vendndodhjen", title_ph: "√áfar√´ po shet?", desc_ph: "Detajet e artikullit...",
        btn_publish: "Publiko", btn_logout: "Dil",
        opt_all: "T√´ gjitha", opt_choose: "Zgjidh...",
        menu_personal: "T√´ dh√´nat personale", menu_listings: "Njoftimet e mia", 
        menu_watchlist: "Lista e d√´shirave", menu_security: "Siguria",
        empty_results: "Asnj√´ rezultat.<br><small>Zgjidhni filt√´r p√´r t√´ par√´ ofertat.</small>",
        filter_km: "Kilometra deri", filter_year: "Viti nga", filter_power: "Fuqia (KF)",
        filter_area: "Sip√´rfaqja (m¬≤)", filter_rooms: "Dhoma nga", filter_floor: "Kati"
      },
      sr: { 
        nav_market: "Pijaca", nav_sell: "Prodaj", nav_profile: "Profil",
        market_title: "Otkrij", market_subtitle: "Pronaƒëi ponude na Balkanu",
        sell_subtitle: "Postavi oglas",
        profile_title: "Moj Profil", profile_subtitle: "Gost",
        search_ph: "Pretra≈æi (npr. Golf 7, Stan)...",
        label_country: "Dr≈æava", label_category: "Kategorija", label_region: "Region / Grad",
        label_subcategory: "Podkategorija", label_title: "Naslov", label_price: "Cena (‚Ç¨)",
        label_description: "Opis", label_photos: "Slike (Max 8)",
        region_ph: "Unesi lokaciju", title_ph: "≈†ta prodaje≈°?", desc_ph: "Detalji artikla...",
        btn_publish: "Objavi", btn_logout: "Odjavi se",
        opt_all: "Sve", opt_choose: "Izaberi...",
        menu_personal: "Liƒçni podaci", menu_listings: "Moji oglasi", 
        menu_watchlist: "Lista ≈æelja", menu_security: "Sigurnost",
        empty_results: "Nema rezultata.<br><small>Izaberi filtere za prikaz ponuda.</small>",
        filter_km: "Kilometra≈æa do", filter_year: "Godi≈°te od", filter_power: "Snaga (KS)",
        filter_area: "Povr≈°ina (m¬≤)", filter_rooms: "Soba od", filter_floor: "Sprat"
      },
      mk: { 
        nav_market: "–ü–∞–∑–∞—Ä", nav_sell: "–ü—Ä–æ–¥–∞—ò", nav_profile: "–ü—Ä–æ—Ñ–∏–ª",
        market_title: "–û—Ç–∫—Ä–∏—ò", market_subtitle: "–ù–∞—ò–¥–∏ –ø–æ–Ω—É–¥–∏ –Ω–∞ –ë–∞–ª–∫–∞–Ω–æ—Ç",
        sell_subtitle: "–û–±—ò–∞–≤–∏ –æ–≥–ª–∞—Å",
        profile_title: "–ú–æ—ò –ü—Ä–æ—Ñ–∏–ª", profile_subtitle: "–ì–æ—Å—Ç–∏–Ω",
        search_ph: "–ë–∞—Ä–∞—ò (–Ω–ø—Ä. Golf 7, –°—Ç–∞–Ω)...",
        label_country: "–î—Ä–∂–∞–≤–∞", label_category: "–ö–∞—Ç–µ–≥–æ—Ä–∏—ò–∞", label_region: "–†–µ–≥–∏–æ–Ω / –ì—Ä–∞–¥",
        label_subcategory: "–ü–æ—Ç–∫–∞—Ç–µ–≥–æ—Ä–∏—ò–∞", label_title: "–ù–∞—Å–ª–æ–≤", label_price: "–¶–µ–Ω–∞ (‚Ç¨)",
        label_description: "–û–ø–∏—Å", label_photos: "–°–ª–∏–∫–∏ (Max 8)",
        region_ph: "–í–Ω–µ—Å–∏ –ª–æ–∫–∞—Ü–∏—ò–∞", title_ph: "–®—Ç–æ –ø—Ä–æ–¥–∞–≤–∞—à?", desc_ph: "–î–µ—Ç–∞–ª–∏ –∑–∞ –∞—Ä—Ç–∏–∫–ª–æ—Ç...",
        btn_publish: "–û–±—ò–∞–≤–∏", btn_logout: "–û–¥—ò–∞–≤–∏ —Å–µ",
        opt_all: "–°–∏—Ç–µ", opt_choose: "–ò–∑–±–µ—Ä–∏...",
        menu_personal: "–õ–∏—á–Ω–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏", menu_listings: "–ú–æ–∏ –æ–≥–ª–∞—Å–∏", 
        menu_watchlist: "–õ–∏—Å—Ç–∞ –Ω–∞ –∂–µ–ª–±–∏", menu_security: "–ë–µ–∑–±–µ–¥–Ω–æ—Å—Ç",
        empty_results: "–ù–µ–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏.<br><small>–ò–∑–±–µ—Ä–∏ —Ñ–∏–ª—Ç—Ä–∏ –∑–∞ –¥–∞ –≤–∏–¥–∏—à –ø–æ–Ω—É–¥–∏.</small>",
        filter_km: "–ö–∏–ª–æ–º–µ—Ç—Ä–∏ –¥–æ", filter_year: "–ì–æ–¥–∏–Ω–∞ –æ–¥", filter_power: "–ú–æ—ú–Ω–æ—Å—Ç (–ö–°)",
        filter_area: "–ü–æ–≤—Ä—à–∏–Ω–∞ (m¬≤)", filter_rooms: "–°–æ–±–∏ –æ–¥", filter_floor: "–ö–∞—Ç"
      }
    };

    const COUNTRIES_DATA = {
      all: { de: "Alle / Egal", en: "All / Any", sq: "T√´ gjitha / Kudo", sr: "Sve / Bilo gde", mk: "–°–∏—Ç–µ" },
      al: { de: "Albanien", en: "Albania", sq: "Shqip√´ria", sr: "Albanija", mk: "–ê–ª–±–∞–Ω–∏—ò–∞" },
      ba: { de: "Bosnien & Herz.", en: "Bosnia & Herz.", sq: "Bosnja dhe H.", sr: "Bosna i Herc.", mk: "–ë–æ—Å–Ω–∞ –∏ –•–µ—Ä—Ü." },
      bg: { de: "Bulgarien", en: "Bulgaria", sq: "Bullgaria", sr: "Bugarska", mk: "–ë—É–≥–∞—Ä–∏—ò–∞" },
      gr: { de: "Griechenland", en: "Greece", sq: "Greqia", sr: "Grƒçka", mk: "–ì—Ä—Ü–∏—ò–∞" },
      xk: { de: "Kosovo", en: "Kosovo", sq: "Kosova", sr: "Kosovo", mk: "–ö–æ—Å–æ–≤–æ" },
      hr: { de: "Kroatien", en: "Croatia", sq: "Kroacia", sr: "Hrvatska", mk: "–•—Ä–≤–∞—Ç—Å–∫–∞" },
      me: { de: "Montenegro", en: "Montenegro", sq: "Mali i Zi", sr: "Crna Gora", mk: "–¶—Ä–Ω–∞ –ì–æ—Ä–∞" },
      mk: { de: "Nordmazedonien", en: "North Macedonia", sq: "Maqedonia e Veriut", sr: "Severna Makedonija", mk: "–°–µ–≤–µ—Ä–Ω–∞ –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞" },
      rs: { de: "Serbien", en: "Serbia", sq: "Serbia", sr: "Srbija", mk: "–°—Ä–±–∏—ò–∞" },
      si: { de: "Slowenien", en: "Slovenia", sq: "Sllovenia", sr: "Slovenija", mk: "–°–ª–æ–≤–µ–Ω–∏—ò–∞" },
      tr: { de: "T√ºrkei", en: "Turkey", sq: "Turqia", sr: "Turska", mk: "–¢—É—Ä—Ü–∏—ò–∞" }
    };

    const CATEGORIES_DATA = {
      vehicles: {
        label: { de: "Fahrzeuge", en: "Vehicles", sq: "Automjete", sr: "Vozila", mk: "–í–æ–∑–∏–ª–∞" },
        subs: [
          { k: "small", de: "Kleinwagen", en: "Small Car" }, { k: "limo", de: "Limousine", en: "Sedan" },
          { k: "wagon", de: "Kombi", en: "Wagon" }, { k: "suv", de: "SUV / Gel√§ndewagen", en: "SUV" },
          { k: "moto", de: "Motorrad", en: "Motorcycle" }, { k: "truck", de: "Nutzfahrzeug", en: "Truck/Van" }
        ],
        // Default Filters
        filters: [ { id: "filter_km" }, { id: "filter_year" }, { id: "filter_power" } ]
      },
      realestate: {
        label: { de: "Immobilien", en: "Real Estate", sq: "Patundshm√´ri", sr: "Nekretnine", mk: "–ù–µ–¥–≤–∏–∂–Ω–æ—Å—Ç–∏" },
        subs: [
          { k: "apt", de: "Wohnung", en: "Apartment" },
          { k: "house", de: "Haus", en: "House" },
          { k: "land", de: "Grundst√ºck", en: "Land" },
          { k: "comm", de: "Gewerbe", en: "Commercial" },
          { k: "garage", de: "Garage", en: "Garage" }
        ],
        filters: [ { id: "filter_area" } ] // Base filter
      },
      electronics: {
        label: { de: "Elektronik", en: "Electronics", sq: "Elektronik√´", sr: "Elektronika", mk: "–ï–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" },
        subs: [
          { k: "phone", de: "Smartphone", en: "Smartphone" }, { k: "laptop", de: "Laptop / PC", en: "Laptop" },
          { k: "console", de: "Konsole", en: "Console" }, { k: "tv", de: "TV & Audio", en: "TV" }
        ],
        filters: []
      }
    };

    // --- APP LOGIC ---
    const app = {
      lang: 'de',

      init: () => {
        app.loadTheme();
        app.setLanguage('de'); 
        app.setupListeners('filter');
        app.setupListeners('sell');
      },

      setLanguage: (langCode) => {
        app.lang = langCode;
        app.translatePage();
        app.populateDropdowns('filter');
        app.populateDropdowns('sell');
        // Reset sub dropdowns
        app.resetSubDropdown('filter');
        app.resetSubDropdown('sell');
      },

      resetSubDropdown: (prefix) => {
        const el = document.getElementById(prefix + '-sub');
        el.innerHTML = `<option>${TRANSLATIONS[app.lang][prefix==='filter'?'opt_all':'opt_choose']}</option>`;
        el.disabled = true;
        app.renderContextFilters(prefix, null, null);
      },

      translatePage: () => {
        const t = TRANSLATIONS[app.lang];
        document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          if (t[key]) el.innerHTML = t[key];
        });
        document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
          const key = el.getAttribute('data-i18n-placeholder');
          if (t[key]) el.placeholder = t[key];
        });
      },

      populateDropdowns: (prefix) => {
        const lang = app.lang;
        
        // Countries
        const countrySel = document.getElementById(prefix + '-country');
        countrySel.innerHTML = "";
        for (const code in COUNTRIES_DATA) {
          const opt = document.createElement('option');
          opt.value = code; 
          opt.textContent = COUNTRIES_DATA[code][lang] || COUNTRIES_DATA[code]['en'];
          countrySel.appendChild(opt);
        }

        // Categories
        const catSel = document.getElementById(prefix + '-cat');
        const currentVal = catSel.value;
        catSel.innerHTML = "";
        const defOpt = document.createElement('option');
        defOpt.value = ""; 
        defOpt.textContent = prefix === 'filter' ? TRANSLATIONS[lang].opt_all : TRANSLATIONS[lang].opt_choose;
        catSel.appendChild(defOpt);

        for (const catKey in CATEGORIES_DATA) {
          const opt = document.createElement('option');
          opt.value = catKey;
          opt.textContent = CATEGORIES_DATA[catKey].label[lang];
          catSel.appendChild(opt);
        }
        catSel.value = currentVal;
      },

      setupListeners: (prefix) => {
        const catSel = document.getElementById(prefix + '-cat');
        const subSel = document.getElementById(prefix + '-sub');
        
        // Category Change
        catSel.addEventListener('change', () => {
          const val = catSel.value;
          const lang = app.lang;
          subSel.innerHTML = ""; 

          const def = document.createElement('option');
          def.textContent = prefix === 'filter' ? TRANSLATIONS[lang].opt_all : TRANSLATIONS[lang].opt_choose;
          def.value = "";
          subSel.appendChild(def);

          if (val && CATEGORIES_DATA[val]) {
            subSel.disabled = false;
            CATEGORIES_DATA[val].subs.forEach(item => {
              const opt = document.createElement('option');
              opt.value = item.k; 
              // Translation fallback logic for simple subs
              let txt = item[lang] || item['en']; 
              opt.textContent = txt;
              subSel.appendChild(opt);
            });
            // Init filters with base category
            app.renderContextFilters(prefix, val, null);
          } else {
            subSel.disabled = true;
            app.renderContextFilters(prefix, null, null);
          }
        });

        // Subcategory Change (KEY CHANGE HERE)
        subSel.addEventListener('change', () => {
            const catVal = catSel.value;
            const subVal = subSel.value;
            app.renderContextFilters(prefix, catVal, subVal);
        });
      },

      renderContextFilters: (prefix, categoryKey, subKey) => {
        const containerId = prefix === 'filter' ? 'dynamic-filters' : 'sell-dynamic-inputs';
        const container = document.getElementById(containerId);
        container.innerHTML = "";
        container.style.display = "none";
        container.classList.remove('show');

        if (!categoryKey || !CATEGORIES_DATA[categoryKey]) return;

        // Base Filters
        let filters = [...CATEGORIES_DATA[categoryKey].filters];
        
        // DYNAMIC FILTER LOGIC (The Smart Part)
        if (categoryKey === 'realestate') {
             // Default is Area. 
             // IF sub is Apartment or House -> Add Rooms + Floor
             if (subKey === 'apt' || subKey === 'house') {
                 filters.push({ id: "filter_rooms" });
                 filters.push({ id: "filter_floor" });
             }
             // IF sub is Land or Garage -> KEEP ONLY AREA (Default)
        }

        if (filters.length === 0) return;

        const lang = app.lang;
        const t = TRANSLATIONS[lang];

        if (prefix === 'filter') {
          container.style.display = "block";
          setTimeout(() => container.classList.add('show'), 10);
          let html = '<div class="grid-2">';
          filters.forEach(f => {
            const label = t[f.id] || f.id;
            html += `
              <div class="ios-input-group" style="margin:0">
                <label class="ios-label">${label}</label>
                <input type="number" class="ios-input" placeholder="0">
              </div>`;
          });
          html += '</div>';
          container.innerHTML = html;
        } else {
          container.style.display = "grid";
          filters.forEach(f => {
            const label = t[f.id] || f.id;
            const div = document.createElement('div');
            div.className = "ios-input-group";
            div.innerHTML = `
              <label class="ios-label">${label}</label>
              <input type="number" class="ios-input" placeholder="0">
            `;
            container.appendChild(div);
          });
        }
      },

      loadTheme: () => {
        const saved = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', saved);
        document.getElementById('theme-icon').textContent = saved === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      },

      nav: (view) => {
        window.scrollTo(0,0);
        ['market', 'sell', 'profile'].forEach(v => {
          document.getElementById('view-' + v).classList.add('hidden');
          document.getElementById('tab-' + v).classList.remove('active');
        });
        document.getElementById('view-' + view).classList.remove('hidden');
        document.getElementById('tab-' + view).classList.add('active');
      },

      toggleTheme: () => {
        const current = document.documentElement.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
        document.getElementById('theme-icon').textContent = next === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      }
    };

    app.init();
  </script>
</body>
</html>
