<!doctype html>
<html lang="de" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#ffffff">
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiWk9OQSBCQUxLTyIs" id="pwa-manifest"> 
  <title>ZONA BALKO ‚Äì Marktplatz</title>
  
  <style>
    /* --- RAI DESIGN SYSTEM (ZONA BALKO) --- */
    :root {
      /* LIGHT MODE */
      --bg-body: #F2F2F7;       
      --bg-card: #FFFFFF;
      --bg-input: #E5E5EA;      
      --text-primary: #000000;
      --text-secondary: #8E8E93;
      --separator: #C6C6C8;     
      --accent: #007AFF;        
      --danger: #FF3B30;        
      --success: #34C759;
      --warning: #FF9500;       
      --whatsapp: #25D366;
      
      --radius-l: 24px;         
      --radius-m: 16px;         
      
      --shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      --font: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      
      --nav-height: 60px;
      --max-width: 800px;
    }

    [data-theme="dark"] {
      /* DARK MODE */
      --bg-body: #000000;
      --bg-card: #1C1C1E;       
      --bg-input: #2C2C2E;
      --text-primary: #FFFFFF;
      --text-secondary: #98989D;
      --separator: #38383A;
      --accent: #0A84FF;
      --shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    
    body {
      background-color: var(--bg-body);
      color: var(--text-primary);
      font-family: var(--font);
      -webkit-font-smoothing: antialiased;
      padding-bottom: 120px; padding-top: env(safe-area-inset-top);
      transition: background-color 0.3s ease;
    }

    button, input, select, textarea { font-family: inherit; border: none; outline: none; }
    a { text-decoration: none; color: inherit; cursor: pointer; }
    .wrap { max-width: var(--max-width); margin: 0 auto; padding: 0 20px; }
    .hidden { display: none !important; }
    .registered-only { display: none !important; }

    /* TOAST */
    .toast-container {
      position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
      z-index: 6000; display: flex; flex-direction: column; gap: 10px; pointer-events: none;
    }
    .toast {
      background: rgba(50, 50, 50, 0.9); backdrop-filter: blur(10px);
      color: #fff; padding: 12px 24px; border-radius: 50px;
      font-size: 14px; font-weight: 600; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      opacity: 0; transform: translateY(-20px); transition: 0.3s;
    }
    .toast.show { opacity: 1; transform: translateY(0); }

    /* HEADER */
    .navbar {
      position: sticky; top: 0; z-index: 1000; height: var(--nav-height);
      background: rgba(255, 255, 255, 0.0); display: flex; align-items: center; justify-content: center;
      margin-bottom: 10px; pointer-events: none; 
    }
    .nav-inner { 
      pointer-events: auto; width: 100%; display: flex; justify-content: space-between; align-items: center; 
      background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      padding: 10px 20px; border-radius: 0 0 24px 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    [data-theme="dark"] .nav-inner { background: rgba(28, 28, 30, 0.85); }

    .logo { 
      font-weight: 800; font-size: 20px; letter-spacing: 0.5px; 
      color: var(--text-primary); cursor: pointer; user-select: none; text-transform: uppercase; white-space: nowrap;
    }
    .logo span { color: var(--accent); }
    .logo:active { opacity: 0.7; transform: scale(0.98); }

    .nav-controls { display: flex; gap: 12px; align-items: center; }

    .lang-select {
      background: var(--bg-input); color: var(--text-primary);
      font-size: 13px; font-weight: 700; padding: 0 12px; height: 36px;
      border-radius: 18px; cursor: pointer; appearance: none; text-align: center; border: 1px solid transparent; transition: 0.2s;
    }
    
    .theme-toggle {
      width: 36px; height: 36px; border-radius: 50%;
      background: var(--bg-input); color: var(--text-primary);
      display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; transition: 0.2s;
    }
    .theme-toggle:active { transform: scale(0.9); }

    /* COMPONENTS */
    .rai-input-group { margin-bottom: 20px; }
    .rai-label {
      display: block; font-size: 11px; text-transform: uppercase; font-weight: 700;
      color: var(--text-secondary); margin-bottom: 8px; margin-left: 12px; letter-spacing: 0.5px;
    }
    .rai-input {
      width: 100%; height: 54px; padding: 0 16px; background: var(--bg-card); color: var(--text-primary);
      border-radius: var(--radius-m); font-size: 17px; box-shadow: 0 2px 8px rgba(0,0,0,0.02); transition: 0.2s;
    }
    .rai-input:focus { box-shadow: 0 0 0 2px var(--accent); transform: scale(1.01); }
    textarea.rai-input { height: auto; padding-top: 16px; min-height: 140px; resize: none; }
    select.rai-input { appearance: none; background-repeat: no-repeat; background-position: right 16px center; background-size: 18px; 
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%238E8E93' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    }

    .rai-card {
      background: var(--bg-card); border-radius: var(--radius-l); padding: 24px; box-shadow: var(--shadow); margin-bottom: 24px; overflow: hidden;
    }

    .rai-btn {
      width: 100%; height: 56px; background: var(--accent); color: #fff; font-size: 17px; font-weight: 700;
      border-radius: 28px; display: flex; align-items: center; justify-content: center; cursor: pointer;
      transition: transform 0.1s, opacity 0.2s, box-shadow 0.2s; box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
    }
    .rai-btn:active { transform: scale(0.96); opacity: 0.9; }
    .rai-btn.secondary { background: var(--bg-input); color: var(--text-primary); box-shadow: none; }
    .rai-btn.danger { background: rgba(255, 59, 48, 0.1); color: var(--danger); box-shadow: none; }
    .rai-btn.google { background: #fff; color: #000; border: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .rai-btn.whatsapp { background: var(--whatsapp); color: #fff; box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3); }
    
    .rai-btn.small { height: 36px; font-size: 13px; padding: 0 16px; width: auto; display: inline-flex; }

    [data-theme="dark"] .rai-btn.google { background: #fff; color: #000; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    @media (max-width: 600px) { .grid-4 { grid-template-columns: 1fr 1fr; } }

    /* MARKET VIEW */
    .market-header { margin: 20px 0 30px 0; text-align: left; padding: 0 10px; }
    .market-title { font-size: 34px; font-weight: 800; margin-bottom: 4px; letter-spacing: -1px; }
    .market-subtitle { color: var(--text-secondary); font-size: 17px; font-weight: 500; }

    .search-wrapper { position: relative; margin-bottom: 24px; }
    .search-input { background: var(--bg-card); border-radius: 20px; padding-left: 50px; height: 60px; font-size: 18px; }
    .search-icon { position: absolute; left: 18px; top: 20px; color: var(--accent); font-size: 20px; }

    .adv-filter-box {
      margin-top: 16px; padding: 20px; background: var(--bg-card); border: 1px solid var(--accent);
      border-radius: var(--radius-m); display: none; box-shadow: var(--shadow);
    }
    .adv-filter-box.show { display: block; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes popIn { from{opacity:0; transform:scale(0.95)} to{opacity:1; transform:scale(1)} }

    .listing-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 30px; }
    @media (min-width: 600px) { .listing-grid { grid-template-columns: repeat(3, 1fr); } }

    .empty-state { grid-column: 1 / -1; padding: 60px 0; text-align: center; color: var(--text-secondary); }
    .empty-icon { font-size: 60px; margin-bottom: 16px; opacity: 0.2; filter: grayscale(1); }

    /* CARD EXTRAS */
    .card-badges { position: absolute; top: 10px; left: 10px; display: flex; flex-direction: column; gap: 5px; z-index: 5; }
    .status-badge { padding: 4px 8px; border-radius: 8px; font-size: 10px; font-weight: 800; text-transform: uppercase; color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    .status-badge.reserved { background: var(--warning); }
    .status-badge.sold { background: #333; }
    .fav-btn { position: absolute; top: 10px; right: 10px; width: 32px; height: 32px; background: rgba(255,255,255,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: 0.2s; }
    .fav-btn.active { color: var(--danger); transform: scale(1.1); }
    .card-location { position: absolute; bottom: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 2px 8px; border-radius: 10px; font-size: 10px; font-weight: bold; color:black; }
    .card-overlay { position: absolute; inset: 0; background: rgba(255,255,255,0.6); z-index: 4; display: none; align-items: center; justify-content: center; font-weight: 800; font-size: 14px; text-transform: uppercase; color: #333; transform: rotate(-10deg); border: 2px solid #333; width: 80%; height: 40px; margin: auto; }

    /* SELL & UPLOAD */
    .upload-box {
      aspect-ratio: 1; background: var(--bg-input); border-radius: var(--radius-m);
      display: flex; align-items: center; justify-content: center; font-size: 28px; color: var(--text-secondary); cursor: pointer; transition: 0.2s;
      position: relative; overflow: hidden;
    }
    .upload-box img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; }
    .upload-box.main { border: 2px dashed var(--accent); color: var(--accent); background: rgba(0, 122, 255, 0.05); }

    /* DASHBOARD */
    .dashboard-header { text-align: center; padding: 40px 0 20px; }
    .dash-avatar-wrapper { position: relative; width: 120px; height: 120px; margin: 0 auto 16px; }
    .dash-avatar {
      width: 100%; height: 100%; border-radius: 50%; background: var(--bg-input); 
      background-size: cover; background-position: center; border: 4px solid var(--bg-card);
      box-shadow: var(--shadow); display: flex; align-items: center; justify-content: center; font-size: 50px;
    }
    .dash-edit-badge {
      position: absolute; bottom: 0; right: 0; width: 36px; height: 36px;
      background: var(--accent); color: #fff; border-radius: 50%; border: 3px solid var(--bg-card);
      display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer;
    }
    .trust-badge { display: inline-flex; align-items: center; gap: 4px; color: var(--accent); font-size: 14px; margin-left: 5px; }
    .dash-info-line { font-size: 13px; color: var(--text-secondary); margin-top: 6px; display: flex; align-items: center; justify-content: center; gap: 6px; }

    .dash-stats { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; margin-top: 20px; }
    .stat-pill {
      background: var(--bg-card); padding: 10px 20px; border-radius: 20px; box-shadow: var(--shadow);
      display: flex; flex-direction: column; align-items: center; min-width: 100px;
    }
    .stat-val { font-size: 18px; font-weight: 800; color: var(--text-primary); }
    .stat-lbl { font-size: 12px; color: var(--text-secondary); font-weight: 600; text-transform: uppercase; }

    .dash-section-title { font-size: 18px; font-weight: 700; margin-bottom: 15px; margin-top: 30px; padding-left: 10px; }

    .list-group { background: var(--bg-card); border-radius: var(--radius-l); overflow: hidden; margin-bottom: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
    .list-item {
      padding: 18px 24px; border-bottom: 0.5px solid var(--separator); display: flex; align-items: center; justify-content: space-between;
      cursor: pointer; font-size: 16px; font-weight: 500; transition: background 0.1s;
    }
    .list-item:last-child { border-bottom: none; }
    .list-item:active { background: var(--bg-input); }
    .list-icon { margin-right: 16px; width: 24px; text-align: center; font-size: 18px; }
    .chevron { color: var(--text-secondary); font-size: 14px; font-weight: 700; opacity: 0.5; }

    /* MODALS & OVERLAYS */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
      z-index: 5000; display: none; align-items: center; justify-content: center; padding: 20px;
    }
    .modal-box {
      background: var(--bg-card); width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto;
      border-radius: var(--radius-l); padding: 24px; box-shadow: var(--shadow);
      animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); display:flex; flex-direction:column;
    }
    .modal-box.large { max-width: 600px; padding: 0; }
    .auth-title { font-size: 22px; font-weight: 800; margin-bottom: 20px; text-align: center; }
    @keyframes popIn { from{opacity:0; transform:scale(0.95)} to{opacity:1; transform:scale(1)} }

    /* DETAIL VIEW STYLES */
    .detail-img-container { width: 100%; height: 300px; background: var(--bg-input); position: relative; }
    .detail-img-container img { width: 100%; height: 100%; object-fit: cover; }
    .detail-content { padding: 24px; padding-bottom: 100px; }
    .detail-price { font-size: 28px; font-weight: 800; color: var(--accent); margin-bottom: 8px; }
    .detail-title { font-size: 22px; font-weight: 700; line-height: 1.3; margin-bottom: 16px; }
    .detail-meta { display: flex; gap: 10px; margin-bottom: 24px; flex-wrap: wrap; }
    .detail-tag { background: var(--bg-input); padding: 6px 12px; border-radius: 8px; font-size: 13px; font-weight: 600; color: var(--text-secondary); display:flex; align-items:center; gap:5px; }
    .detail-desc { font-size: 16px; line-height: 1.6; color: var(--text-primary); margin-bottom: 30px; white-space: pre-wrap; }
    .seller-card { background: var(--bg-input); padding: 16px; border-radius: 16px; display: flex; align-items: center; gap: 15px; }
    .seller-av { width: 50px; height: 50px; border-radius: 50%; background: #ccc; background-size: cover; background-position: center; }
    .detail-actions { position: absolute; bottom: 0; left: 0; right: 0; background: var(--bg-card); padding: 16px 24px; border-top: 1px solid var(--separator); display: flex; gap: 10px; }
    .close-fab { position: absolute; top: 15px; right: 15px; width: 36px; height: 36px; background: rgba(0,0,0,0.5); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; z-index: 10; }
    .report-fab { position: absolute; top: 15px; left: 15px; width: 36px; height: 36px; background: rgba(255,255,255,0.9); border-radius: 50%; color: var(--danger); display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; z-index: 10; font-size: 18px; }

    /* LEGAL LINKS IN FOOTER */
    .legal-footer { text-align: center; margin-top: 20px; font-size: 12px; color: var(--text-secondary); display: flex; gap: 15px; justify-content: center; }
    .legal-link { color: var(--text-secondary); text-decoration: none; }

    
    /* LEGAL CONTENT */
    .legal-content { font-size: 14px; line-height: 1.6; color: var(--text-primary); }
    .legal-content h3 { margin-top: 16px; font-size: 15px; }
    .legal-content p { margin-top: 10px; color: var(--text-primary); }
    .legal-content ul { margin-top: 10px; padding-left: 18px; }
    .legal-content li { margin-top: 6px; }
    .legal-content .muted { color: var(--text-secondary); font-size: 12px; margin-top: 12px; }
    /* DOCK */
    .tab-bar-container { position: fixed; bottom: 30px; left: 0; right: 0; z-index: 2000; display: flex; justify-content: center; pointer-events: none; }
    .tab-bar { pointer-events: auto; height: 70px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border-radius: 35px; display: flex; align-items: center; justify-content: space-between; padding: 0 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.2); min-width: 280px; }
    [data-theme="dark"] .tab-bar { background: rgba(40, 40, 42, 0.85); border-color: rgba(255,255,255,0.1); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
    .tab-item { width: 60px; height: 60px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-secondary); cursor: pointer; border-radius: 50%; transition: all 0.25s; }
    .tab-icon { font-size: 26px; margin-bottom: 0; transition: transform 0.2s; }
    .tab-item.active { color: #fff; background: var(--accent); transform: translateY(-10px) scale(1.1); box-shadow: 0 6px 15px rgba(0, 122, 255, 0.4); }
    .tab-item:active { transform: scale(0.9); }

  </style>
</head>
<body>

  <div class="toast-container" id="toast-container"></div>
  
  <div class="modal-overlay" id="auth-modal">
    <div class="modal-box">
      <div class="auth-title" id="auth-title" data-i18n="auth_welcome">Willkommen</div>
      <button class="rai-btn google" onclick="app.loginGoogle()" style="margin-bottom:15px; display:flex; gap:10px;">
        <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        <span data-i18n="btn_google">Weiter mit Google</span>
      </button>
      <div style="text-align:center; color:var(--text-secondary); margin:10px 0; font-size:12px;" data-i18n="auth_or">ODER</div>
      <div class="rai-input-group"><label class="rai-label" data-i18n="label_email">Email</label><input type="email" id="auth-email" class="rai-input" placeholder="mail@example.com"></div>
      <div class="rai-input-group"><label class="rai-label" data-i18n="label_password">Passwort</label><input type="password" id="auth-pass" class="rai-input" placeholder="******"></div>
      <button class="rai-btn" id="btn-auth-action" data-i18n="btn_login">Einloggen</button>
      <button class="rai-btn secondary" style="margin-top:10px" id="btn-auth-switch" data-i18n="btn_no_account">Kein Konto? Registrieren</button>
      <button class="rai-btn secondary" style="margin-top:10px; background:transparent; border:1px solid var(--separator);" onclick="app.closeModal('auth-modal')" data-i18n="btn_cancel">Abbrechen</button>
      
      <div class="legal-footer">
        <a href="#" class="legal-link" data-i18n="lnk_impressum">Impressum</a>
        <a href="#" class="legal-link" data-i18n="lnk_privacy">Datenschutz</a>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="settings-modal">
    <div class="modal-box">
      <div class="auth-title" data-i18n="title_settings">Profil bearbeiten</div>
      <div class="rai-input-group"><label class="rai-label" data-i18n="label_displayname">Anzeigename</label><input type="text" id="set-name" class="rai-input"></div>
      <div class="rai-input-group"><label class="rai-label" data-i18n="label_phone">Telefonnummer</label><input type="tel" id="set-phone" class="rai-input" placeholder="+41 79 ..."></div>
      <div class="rai-input-group">
        <label class="rai-label" data-i18n="label_privacy">Privatsph√§re (Nummer)</label>
        <select id="set-privacy" class="rai-input">
          <option value="registered" data-i18n="opt_registered">Nur Registrierte</option>
          <option value="public" data-i18n="opt_public">√ñffentlich</option>
          <option value="hidden" data-i18n="opt_hidden">Verbergen</option>
        </select>
      </div>
      <button class="rai-btn" onclick="app.saveSettings()" data-i18n="btn_save">Speichern</button>
      <button class="rai-btn secondary" style="margin-top:10px; background:transparent;" onclick="app.closeModal('settings-modal')" data-i18n="btn_cancel">Abbrechen</button>
    </div>
  </div>

  <div class="modal-overlay" id="report-modal">
    <div class="modal-box">
      <div class="auth-title" data-i18n="title_report">Inserat melden</div>
      <p style="margin-bottom:20px; color:var(--text-secondary); text-align:center;" data-i18n="desc_report">Warum m√∂chtest du dieses Inserat melden?</p>
      <div class="rai-input-group">
        <select id="report-reason" class="rai-input">
          <option value="spam">Spam / Werbung</option>
          <option value="fraud">Betrug / Fake</option>
          <option value="wrong_category">Falsche Kategorie</option>
          <option value="offensive">Unangemessener Inhalt</option>
        </select>
      </div>
      <button class="rai-btn danger" onclick="app.submitReport()" data-i18n="btn_submit_report">Melden</button>
      <button class="rai-btn secondary" style="margin-top:10px; background:transparent;" onclick="app.closeModal('report-modal')" data-i18n="btn_cancel">Abbrechen</button>
    </div>
  </div>

  <div class="modal-overlay" id="detail-modal">
    <div class="modal-box large" style="height: 100%; max-height: 100%; border-radius: 0; max-width: 100%; position: relative;">
      <div class="close-fab" onclick="app.closeModal('detail-modal')">‚úï</div>
      <div class="report-fab" onclick="app.openReport()">‚ö†Ô∏è</div>
      <div style="overflow-y: auto; flex: 1;">
        <div class="detail-img-container" id="detail-img-box"></div>
        <div class="detail-content">
          <div class="detail-price" id="detail-price">‚Ç¨ 0</div>
          <div class="detail-title" id="detail-title">Titel</div>
          <div class="detail-meta">
            <div class="detail-tag">üìç <span id="detail-loc">Ort</span></div>
            <div class="detail-tag">üè∑Ô∏è <span id="detail-cat">Kat</span></div>
            <div class="detail-tag">üìÖ <span id="detail-date">Datum</span></div>
          </div>
          <div class="seller-card" style="margin-bottom:20px;">
            <div class="seller-av" id="detail-seller-av"></div>
            <div>
              <div style="font-weight:700" id="detail-seller-name">Verk√§ufer</div>
              <div style="font-size:12px; color:var(--text-secondary);" data-i18n="lbl_seller">Verk√§ufer auf ZONA</div>
            </div>
          </div>
          <div class="detail-desc" id="detail-desc">Beschreibung...</div>
        </div>
      </div>
      <div class="detail-actions">
        <button class="rai-btn secondary" style="flex:1" onclick="app.contactSeller('call')" data-i18n="btn_call">üìû Anrufen</button>
        <button class="rai-btn whatsapp" style="flex:1" onclick="app.contactSeller('whatsapp')" data-i18n="btn_whatsapp">üí¨ WhatsApp</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="my-listings-modal">
    <div class="modal-box">
      <div class="auth-title" id="modal-list-title">Liste</div>
      <div id="my-listings-list" style="display:flex; flex-direction:column; gap:10px;"></div>
      <button class="rai-btn secondary" style="margin-top:20px;" onclick="app.closeModal('my-listings-modal')" data-i18n="btn_close">Schlie√üen</button>
    </div>
  </div>

  
  <!-- IMPRESSUM MODAL -->
  <div class="modal-overlay" id="imprint-modal">
    <div class="modal-box">
      <div class="auth-title" data-i18n="imprint_title">Impressum</div>
      <div class="legal-content" id="imprint-content"></div>
      <button class="rai-btn secondary" style="margin-top:10px; background:transparent;" onclick="app.closeModal('imprint-modal')" data-i18n="btn_close">Schlie√üen</button>
    </div>
  </div>

  <!-- PRIVACY MODAL -->
  <div class="modal-overlay" id="privacy-modal">
    <div class="modal-box">
      <div class="auth-title" data-i18n="privacy_title">Datenschutz</div>
      <div class="legal-content" id="privacy-content"></div>
      <button class="rai-btn secondary" style="margin-top:10px; background:transparent;" onclick="app.closeModal('privacy-modal')" data-i18n="btn_close">Schlie√üen</button>
    </div>
  </div>

  <input type="file" id="avatar-input" hidden accept="image/*">
  <input type="file" id="upload-input" hidden accept="image/*">

  <nav class="navbar">
    <div class="wrap nav-inner">
      <div class="logo" onclick="app.nav('market')">ZONA BALKO<span>.</span></div>
      <div class="nav-controls">
        <select class="lang-select" id="lang-switcher" onchange="app.setLanguage(this.value)">
          <option value="de">DE</option>
          <option value="en">EN</option>
          <option value="sq">SQ</option>
          <option value="sr">SR</option>
          <option value="mk">MK</option>
        </select>
        <div class="theme-toggle" onclick="app.toggleTheme()">
          <span id="theme-icon">üåô</span>
        </div>
      </div>
    </div>
  </nav>

  <main class="wrap">
    
    <section id="view-market">
      <div class="market-header">
        <div class="market-title" data-i18n="market_title">Entdecken</div>
        <div class="market-subtitle" data-i18n="market_subtitle">Finde Angebote im Balkan (Preise in ‚Ç¨)</div>
      </div>

      <div class="search-wrapper">
        <span class="search-icon">üîç</span>
        <input type="text" class="rai-input search-input" id="search-input" placeholder="" data-i18n-placeholder="search_ph" oninput="app.loadListings()">
      </div>

      <div class="grid-2" style="margin-bottom: 16px;">
        <div class="rai-input-group" style="margin:0;"><label class="rai-label" data-i18n="label_country">Land</label><select class="rai-input" id="filter-country" onchange="app.loadListings()"></select></div>
        <div class="rai-input-group" style="margin:0;"><label class="rai-label" data-i18n="label_category">Kategorie</label><select class="rai-input" id="filter-cat"></select></div>
      </div>

      <div class="grid-2">
        <div class="rai-input-group" style="margin:0;"><label class="rai-label" data-i18n="label_region">Region / Stadt</label><input type="text" class="rai-input" id="filter-region" placeholder="" data-i18n-placeholder="region_ph" oninput="app.loadListings()"></div>
        <div class="rai-input-group" style="margin:0;"><label class="rai-label" data-i18n="label_subcategory">Unterkategorie</label><select class="rai-input" id="filter-sub" disabled onchange="app.loadListings()"><option data-i18n="opt_all">Alle</option></select></div>
      </div>

      <div id="dynamic-filters" class="adv-filter-box"></div>

      <div class="listing-grid" id="market-listings">
        <div class="empty-state"><div class="empty-icon">üõí</div><div data-i18n="empty_results">Keine Ergebnisse.</div></div>
      </div>
    </section>

    <section id="view-sell" class="hidden">
      <div class="market-header">
        <div class="market-title" data-i18n="nav_sell">Verkaufen</div>
        <div class="market-subtitle" data-i18n="sell_subtitle">Inserat aufgeben</div>
      </div>

      <div class="rai-card">
        <div class="rai-label" style="margin-bottom:12px;" data-i18n="label_photos">Fotos (Max 8)</div>
        <div class="grid-4" id="upload-grid">
          <div class="upload-box main" onclick="app.triggerUpload(0)">üì∑</div>
          <div class="upload-box" onclick="app.triggerUpload(1)">+</div>
          <div class="upload-box" onclick="app.triggerUpload(2)">+</div>
          <div class="upload-box" onclick="app.triggerUpload(3)">+</div>
        </div>
      </div>

      <div class="rai-card">
        <div class="rai-input-group"><label class="rai-label" data-i18n="label_title">Titel</label><input type="text" class="rai-input" id="sell-title" placeholder="" data-i18n-placeholder="title_ph"></div>
        <div class="grid-2">
           <div class="rai-input-group"><label class="rai-label" data-i18n="label_country">Land</label><select class="rai-input" id="sell-country"></select></div>
           <div class="rai-input-group"><label class="rai-label" data-i18n="label_price">Preis (‚Ç¨)</label><input type="number" class="rai-input" id="sell-price" placeholder="0"></div>
        </div>
        <div class="grid-2">
          <div class="rai-input-group"><label class="rai-label" data-i18n="label_category">Kategorie</label><select class="rai-input" id="sell-cat"></select></div>
          <div class="rai-input-group"><label class="rai-label" data-i18n="label_subcategory">Unterkategorie</label><select class="rai-input" id="sell-sub" disabled><option data-i18n="opt_choose">W√§hlen...</option></select></div>
        </div>
        <div id="sell-dynamic-inputs" class="grid-2" style="margin-bottom: 20px; display:none;"></div>
        <div class="rai-input-group"><label class="rai-label" data-i18n="label_description">Beschreibung</label><textarea class="rai-input" id="sell-desc" placeholder="" data-i18n-placeholder="desc_ph"></textarea></div>
        <button class="rai-btn" data-i18n="btn_publish" onclick="app.publishListing()">Ver√∂ffentlichen</button>
      </div>
    </section>

    <section id="view-profile" class="hidden">
      <div id="profile-content-logged-in" style="display:none;">
        <div class="dashboard-header">
          <div class="dash-avatar-wrapper">
            <div class="dash-avatar" id="dash-avatar">üë§</div>
            <div class="dash-edit-badge" onclick="app.triggerAvatarUpload()">‚úé</div>
          </div>
          <div class="market-title" style="font-size:24px;">
            <span id="dash-name">Name</span> <span id="dash-verified" class="trust-badge" style="display:none;">‚òëÔ∏è</span>
          </div>
          
          <div class="dash-info-line">
            <span id="dash-rating" style="display:none;"></span> 
            <span id="dash-separator" style="display:none;">‚Ä¢</span> 
            <span id="dash-since"></span>
          </div>

          <div class="market-subtitle" id="dash-email" style="margin-top:5px;">email@example.com</div>
          <div style="margin-top:10px;">
            <button class="rai-btn secondary small" onclick="app.removeAvatar()" style="color:var(--danger)" data-i18n="btn_remove_pic">Bild entfernen</button>
          </div>
        </div>

        <div class="dash-stats">
          <div class="stat-pill"><span class="stat-val" id="stat-listings">0</span><span class="stat-lbl" data-i18n="lbl_listings">Inserate</span></div>
          <div class="stat-pill" onclick="app.openWatchlist()">
            <span class="stat-val" id="stat-watchlist">0</span>
            <span class="stat-lbl" data-i18n="lbl_watchlist">Merkliste</span>
          </div>
        </div>

        <div class="dash-section-title" data-i18n="sec_settings">Einstellungen</div>
        <div class="list-group">
          <div class="list-item" onclick="app.openSettings()">
            <div style="display:flex; align-items:center;"><span class="list-icon">‚öôÔ∏è</span> <span data-i18n="menu_settings">Daten & Privatsph√§re</span></div>
            <span class="chevron">‚Ä∫</span>
          </div>
          <div class="list-item">
            <div style="display:flex; align-items:center; gap: 15px;">
               <a href="#" class="legal-link" style="font-size:14px; text-decoration:none; color:var(--text-primary);" data-i18n="lnk_impressum">Impressum</a>
               <a href="#" class="legal-link" style="font-size:14px; text-decoration:none; color:var(--text-primary);" data-i18n="lnk_privacy">Datenschutz</a>
            </div>
          </div>
        </div>

        <div class="dash-section-title" data-i18n="sec_manage">Verwaltung</div>
        <div class="list-group" id="dash-listings-container">
          </div>

        <div style="text-align:center; margin-top:30px; margin-bottom: 20px;">
          <button class="rai-btn secondary" style="color:var(--text-primary); width:auto; padding:0 30px; margin-bottom:10px;" data-i18n="btn_logout" onclick="app.logout()">Abmelden</button><br>
          <button style="background:none; border:none; color:var(--text-secondary); font-size:12px; text-decoration:underline; cursor:pointer;" data-i18n="btn_delete_account" onclick="app.deleteAccount()">Account l√∂schen</button>
        </div>
      </div>

      <div id="profile-content-guest" style="padding-top:60px;">
        <div class="rai-card" style="text-align:center; padding:40px;">
          <div style="font-size:50px; margin-bottom:20px;">üîí</div>
          <h2 style="margin-bottom:10px;" data-i18n="guest_title">Profil gesch√ºtzt</h2>
          <p style="margin-bottom:30px; color:var(--text-secondary); line-height:1.5;" data-i18n="guest_desc">Melde dich an, um deine Inserate zu verwalten.</p>
          <button class="rai-btn" onclick="app.openAuth('login')" data-i18n="btn_login_register">Anmelden / Registrieren</button>
        </div>
      </div>
    </section>
  </main>

  <div class="tab-bar-container">
    <div class="tab-bar">
      <div class="tab-item active" id="tab-market" onclick="app.nav('market')"><div class="tab-icon">üîç</div></div>
      <div class="tab-item" id="tab-sell" onclick="app.nav('sell')"><div class="tab-icon">‚ûï</div></div>
      <div class="tab-item" id="tab-profile" onclick="app.nav('profile')"><div class="tab-icon">üë§</div></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, signInWithPopup, GoogleAuthProvider, deleteUser } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, doc, setDoc, getDoc, deleteDoc, updateDoc, where, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCgKSVhDFzoDUs2Sc9jkNoGBTR9Sspu2JE",
      authDomain: "zonabalko.firebaseapp.com",
      projectId: "zonabalko",
      storageBucket: "zonabalko.firebasestorage.app",
      messagingSenderId: "1095024300350",
      appId: "1:1095024300350:web:e436232a2b5cccda58dc6f"
    };

    const fbApp = initializeApp(firebaseConfig);
    const auth = getAuth(fbApp);
    const db = getFirestore(fbApp);
    const googleProvider = new GoogleAuthProvider();

    // --- SERVICE WORKER REGISTRATION (PWA) ---
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Minimal Service Worker inline registration for simple PWA behavior
        // In a real file setup, you would create a sw.js file.
        // This is a placeholder to trigger the browser PWA heuristics.
        navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgKGUpID0+IHsgY29uc29sZS5sb2coJ1NXIGluc3RhbGxlZCcpOyB9KTs=').then(() => {}, () => {}); 
      });
    }

    // --- TRANSLATION DATABASE ---
    const TRANSLATIONS = {
      de: {
        nav_market: "Markt", nav_sell: "Verkaufen", nav_profile: "Profil",
        market_title: "Entdecken", market_subtitle: "Finde Angebote im Balkan (Preise in ‚Ç¨)",
        sell_subtitle: "Inserat aufgeben", profile_title: "Mein Profil", profile_subtitle: "Gast",
        search_ph: "Suche...", label_country: "Land", label_category: "Kategorie", label_region: "Region / Stadt",
        label_subcategory: "Unterkategorie", label_title: "Titel", label_price: "Preis (‚Ç¨)",
        label_description: "Beschreibung", label_photos: "Fotos (Max 8)",
        region_ph: "Ort eingeben", title_ph: "Titel...", desc_ph: "Details...",
        btn_publish: "Ver√∂ffentlichen", btn_logout: "Abmelden", btn_login_register: "Anmelden / Registrieren",
        btn_cancel: "Abbrechen", btn_save: "Speichern", btn_remove_pic: "Bild entfernen",
        opt_all: "Alle", opt_choose: "W√§hlen...", btn_close: "Schlie√üen", btn_delete_account: "Account l√∂schen",
        lbl_listings: "Inserate", lbl_watchlist: "Merkliste", sec_settings: "Einstellungen", sec_manage: "Verwaltung",
        menu_settings: "Daten & Privatsph√§re", guest_title: "Profil gesch√ºtzt", guest_desc: "Melde dich an, um deine Inserate zu verwalten.",
        empty_results: "Keine Ergebnisse.", filter_km: "Kilometer bis", filter_year: "Jahr ab", filter_power: "PS",
        filter_area: "m¬≤", filter_rooms: "Zimmer", filter_floor: "Etage",
        auth_welcome: "Willkommen", auth_or: "ODER", btn_google: "Weiter mit Google",
        label_email: "Email", label_password: "Passwort", btn_login: "Einloggen", btn_no_account: "Kein Konto? Registrieren",
        label_displayname: "Anzeigename", label_phone: "Telefonnummer", label_privacy: "Privatsph√§re",
        opt_registered: "Nur Registrierte", opt_public: "√ñffentlich", opt_hidden: "Verbergen",
        toast_login_ok: "Erfolgreich angemeldet!", toast_reg_ok: "Konto erstellt!", toast_logout: "Abgemeldet",
        toast_saved: "Gespeichert!", toast_deleted: "Gel√∂scht.", toast_published: "Inserat ver√∂ffentlicht!",
        toast_error: "Fehler: ", toast_wait: "Bitte warten...", toast_fill_all: "Bitte alles ausf√ºllen!",
        alert_delete: "Wirklich l√∂schen?", alert_remove_pic: "Bild wirklich entfernen?", alert_delete_acc: "Warnung: Alle deine Inserate werden gel√∂scht! Fortfahren?",
        btn_call: "üìû Anrufen", btn_whatsapp: "üí¨ WhatsApp", lbl_seller: "Verk√§ufer auf ZONA",
        msg_no_phone: "Keine Nummer angegeben.", msg_hidden_phone: "Nummer ist verborgen.",
        lbl_sold: "VERKAUFT", lbl_reserved: "RESERVIERT", lbl_active: "AKTIV", lbl_member_since: "Dabei seit",
        title_report: "Inserat melden", desc_report: "Warum m√∂chtest du dieses Inserat melden?", btn_submit_report: "Melden",
        lnk_impressum: "Impressum", lnk_privacy: "Datenschutz",
        imprint_title: "Impressum", privacy_title: "Datenschutz"
      },
      en: {
        nav_market: "Market", nav_sell: "Sell", nav_profile: "Profile",
        market_title: "Discover", market_subtitle: "Find offers in the Balkans (Prices in ‚Ç¨)",
        sell_subtitle: "Post Ad", profile_title: "Profile", profile_subtitle: "Guest", search_ph: "Search...",
        label_country: "Country", label_category: "Category", label_region: "City",
        label_subcategory: "Subcategory", label_title: "Title", label_price: "Price",
        label_description: "Description", label_photos: "Photos", region_ph: "City", title_ph: "Title", desc_ph: "Details",
        btn_publish: "Publish", btn_logout: "Log out", btn_login_register: "Login / Register",
        btn_cancel: "Cancel", btn_save: "Save", btn_remove_pic: "Remove Picture", btn_close: "Close", btn_delete_account: "Delete Account",
        opt_all: "All", opt_choose: "Choose",
        lbl_listings: "Listings", lbl_watchlist: "Watchlist", sec_settings: "Settings", sec_manage: "Manage",
        menu_settings: "Data & Privacy", guest_title: "Profile Locked", guest_desc: "Login to manage listings.",
        empty_results: "No results.", filter_km: "Max Mileage", filter_year: "Min Year", filter_power: "Power (HP)",
        filter_area: "Min Area (m¬≤)", filter_rooms: "Min Rooms", filter_floor: "Floor",
        auth_welcome: "Welcome", auth_or: "OR", btn_google: "Continue with Google",
        label_email: "Email", label_password: "Password", btn_login: "Login", btn_no_account: "No account? Register",
        label_displayname: "Display Name", label_phone: "Phone Number", label_privacy: "Privacy",
        opt_registered: "Registered Only", opt_public: "Public", opt_hidden: "Hidden",
        toast_login_ok: "Logged in!", toast_reg_ok: "Account created!", toast_logout: "Logged out",
        toast_saved: "Saved!", toast_deleted: "Deleted.", toast_published: "Published!",
        toast_error: "Error: ", toast_wait: "Please wait...", toast_fill_all: "Fill all fields!",
        alert_delete: "Really delete?", alert_remove_pic: "Really remove picture?", alert_delete_acc: "Warning: All your listings will be deleted! Proceed?",
        btn_call: "üìû Call", btn_whatsapp: "üí¨ WhatsApp", lbl_seller: "Seller on ZONA",
        msg_no_phone: "No number provided.", msg_hidden_phone: "Number is hidden.",
        lbl_sold: "SOLD", lbl_reserved: "RESERVED", lbl_active: "ACTIVE", lbl_member_since: "Member since",
        title_report: "Report Listing", desc_report: "Why are you reporting this?", btn_submit_report: "Report",
        lnk_impressum: "Imprint", lnk_privacy: "Privacy Policy",
        imprint_title: "Legal notice", privacy_title: "Privacy policy"
      },
      sq: { nav_market: "Tregu", nav_sell: "Shit", nav_profile: "Profili", market_title: "Zbulo", market_subtitle: "Ballkan (‚Ç¨)", sell_subtitle: "Shit", profile_title: "Profili", profile_subtitle: "Mysafir", search_ph: "K√´rko...", label_country: "Shteti", label_category: "Kategoria", label_region: "Qyteti", label_subcategory: "N√´nkategoria", label_title: "Titulli", label_price: "√ámimi", label_description: "P√´rshkrimi", label_photos: "Foto", region_ph: "Qyteti", title_ph: "Titulli", desc_ph: "Detajet", btn_publish: "Publiko", btn_logout: "Dil", btn_login_register: "Hyni / Regjistrohu", btn_cancel: "Anulo", btn_save: "Ruaj", btn_remove_pic: "Hiq Foton", btn_close: "Mbyll", btn_delete_account: "Fshi Llogarin√´", opt_all: "T√´ gjitha", opt_choose: "Zgjidh", lbl_listings: "Njoftimet", lbl_watchlist: "Lista", sec_settings: "Cil√´simet", sec_manage: "Menaxho", menu_settings: "T√´ dh√´nat & Privat√´sia", guest_title: "Profili i mbyllur", guest_desc: "Hyni p√´r t√´ menaxhuar.", empty_results: "Asnj√´ rezultat.", filter_km: "KM", filter_year: "Viti", filter_power: "KF", filter_area: "m¬≤", filter_rooms: "Dhoma", filter_floor: "Kati", auth_welcome: "Mir√´sevini", auth_or: "OSE", btn_google: "Vazhdo me Google", label_email: "Email", label_password: "Fjal√´kalimi", btn_login: "Hyni", btn_no_account: "Nuk keni llogari?", label_displayname: "Emri", label_phone: "Telefoni", label_privacy: "Privat√´sia", opt_registered: "Vet√´m t√´ regjistruarit", opt_public: "Publike", opt_hidden: "Fshehur", toast_login_ok: "Hyrje me sukses!", toast_reg_ok: "Llogaria u krijua!", toast_logout: "Dol√´t", toast_saved: "U ruajt!", toast_deleted: "U fshi.", toast_published: "U publikua!", toast_error: "Gabim: ", toast_wait: "Ju lutem prisni...", toast_fill_all: "Plot√´soni t√´ gjitha!", alert_delete: "A jeni i sigurt?", alert_remove_pic: "Hiq foton?", alert_delete_acc: "Kujdes: T√´ gjitha njoftimet do fshihen! Vazhdo?", btn_call: "üìû Telefono", btn_whatsapp: "üí¨ WhatsApp", lbl_seller: "Shit√´si n√´ ZONA", msg_no_phone: "S'ka num√´r.", msg_hidden_phone: "Numri i fshehur.", lbl_sold: "SHITUR", lbl_reserved: "RESERVUAR", lbl_active: "AKTIV", lbl_member_since: "An√´tar q√´ nga", title_report: "Raporto", desc_report: "Pse po e raportoni?", btn_submit_report: "Raporto", lnk_impressum: "Imprint", lnk_privacy: "Privat√´sia",
        imprint_title: "Impresum", privacy_title: "Privat√´sia" },
      sr: { nav_market: "Pijaca", nav_sell: "Prodaj", nav_profile: "Profil", market_title: "Otkrij", market_subtitle: "Balkan (‚Ç¨)", sell_subtitle: "Prodaj", profile_title: "Profil", profile_subtitle: "Gost", search_ph: "Pretra≈æi...", label_country: "Dr≈æava", label_category: "Kategorija", label_region: "Grad", label_subcategory: "Podkategorija", label_title: "Naslov", label_price: "Cena", label_description: "Opis", label_photos: "Slike", region_ph: "Grad", title_ph: "Naslov", desc_ph: "Detalji", btn_publish: "Objavi", btn_logout: "Odjavi se", btn_login_register: "Prijava / Registracija", btn_cancel: "Otka≈æi", btn_save: "Saƒçuvaj", btn_remove_pic: "Ukloni sliku", btn_close: "Zatvori", btn_delete_account: "Obri≈°i Nalog", opt_all: "Sve", opt_choose: "Izaberi", lbl_listings: "Oglasi", lbl_watchlist: "Lista", sec_settings: "Pode≈°avanja", sec_manage: "Upravljanje", menu_settings: "Podaci & Privatnost", guest_title: "Profil zakljuƒçan", guest_desc: "Prijavi se za upravljanje.", empty_results: "Nema rezultata.", filter_km: "KM", filter_year: "Godi≈°te", filter_power: "KS", filter_area: "m¬≤", filter_rooms: "Soba", filter_floor: "Sprat", auth_welcome: "Dobrodo≈°li", auth_or: "ILI", btn_google: "Nastavi sa Google-om", label_email: "Email", label_password: "Lozinka", btn_login: "Prijava", btn_no_account: "Nema≈° nalog?", label_displayname: "Ime", label_phone: "Telefon", label_privacy: "Privatnost", opt_registered: "Samo registrovani", opt_public: "Javno", opt_hidden: "Sakriveno", toast_login_ok: "Uspe≈°na prijava!", toast_reg_ok: "Nalog kreiran!", toast_logout: "Odjavljen", toast_saved: "Saƒçuvano!", toast_deleted: "Obrisano.", toast_published: "Objavljeno!", toast_error: "Gre≈°ka: ", toast_wait: "Saƒçekajte...", toast_fill_all: "Popuni sve!", alert_delete: "Sigurno obrisati?", alert_remove_pic: "Ukloniti sliku?", alert_delete_acc: "Pa≈ænja: Svi oglasi ƒáe biti obrisani! Nastavi?", btn_call: "üìû Pozovi", btn_whatsapp: "üí¨ WhatsApp", lbl_seller: "Prodavac na ZONA", msg_no_phone: "Nema broja.", msg_hidden_phone: "Broj sakriven.", lbl_sold: "PRODATO", lbl_reserved: "REZERVISANO", lbl_active: "AKTIVNO", lbl_member_since: "ƒålan od", title_report: "Prijavi", desc_report: "Za≈°to prijavljuje≈°?", btn_submit_report: "Prijavi", lnk_impressum: "Impresum", lnk_privacy: "Privatnost",
        imprint_title: "Impresum", privacy_title: "Politika privatnosti" },
      mk: { nav_market: "–ü–∞–∑–∞—Ä", nav_sell: "–ü—Ä–æ–¥–∞—ò", nav_profile: "–ü—Ä–æ—Ñ–∏–ª", market_title: "–û—Ç–∫—Ä–∏—ò", market_subtitle: "–ë–∞–ª–∫–∞–Ω (‚Ç¨)", sell_subtitle: "–ü—Ä–æ–¥–∞—ò", profile_title: "–ü—Ä–æ—Ñ–∏–ª", profile_subtitle: "–ì–æ—Å—Ç–∏–Ω", search_ph: "–ë–∞—Ä–∞—ò...", label_country: "–î—Ä–∂–∞–≤–∞", label_category: "–ö–∞—Ç–µ–≥–æ—Ä–∏—ò–∞", label_region: "–ì—Ä–∞–¥", label_subcategory: "–ü–æ—Ç–∫–∞—Ç–µ–≥–æ—Ä–∏—ò–∞", label_title: "–ù–∞—Å–ª–æ–≤", label_price: "–¶–µ–Ω–∞", label_description: "–û–ø–∏—Å", label_photos: "–°–ª–∏–∫–∏", region_ph: "–ì—Ä–∞–¥", title_ph: "–ù–∞—Å–ª–æ–≤", desc_ph: "–î–µ—Ç–∞–ª–∏", btn_publish: "–û–±—ò–∞–≤–∏", btn_logout: "–û–¥—ò–∞–≤–∏ —Å–µ", btn_login_register: "–ù–∞—ò–∞–≤–∞ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—ò–∞", btn_cancel: "–û—Ç–∫–∞–∂–∏", btn_save: "–ó–∞—á—É–≤–∞—ò", btn_remove_pic: "–¢—Ä–≥–Ω–∏ —Å–ª–∏–∫–∞", btn_close: "–ó–∞—Ç–≤–æ—Ä–∏", btn_delete_account: "–ò–∑–±—Ä–∏—à–∏ —Å–º–µ—Ç–∫–∞", opt_all: "–°–∏—Ç–µ", opt_choose: "–ò–∑–±–µ—Ä–∏", lbl_listings: "–û–≥–ª–∞—Å–∏", lbl_watchlist: "–õ–∏—Å—Ç–∞", sec_settings: "–ü–æ—Å—Ç–∞–≤–∫–∏", sec_manage: "–£–ø—Ä–∞–≤—É–≤–∞—ö–µ", menu_settings: "–ü–æ–¥–∞—Ç–æ—Ü–∏ & –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç", guest_title: "–ó–∞–∫–ª—É—á–µ–Ω –ø—Ä–æ—Ñ–∏–ª", guest_desc: "–ù–∞—ò–∞–≤–∏ —Å–µ –∑–∞ —É–ø—Ä–∞–≤—É–≤–∞—ö–µ.", empty_results: "–ù–µ–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏.", filter_km: "–ö–ú", filter_year: "–ì–æ–¥–∏–Ω–∞", filter_power: "–ö–°", filter_area: "m¬≤", filter_rooms: "–°–æ–±–∏", filter_floor: "–ö–∞—Ç", auth_welcome: "–î–æ–±—Ä–µ–¥–æ—ò–¥–æ–≤—Ç–µ", auth_or: "–ò–õ–ò", btn_google: "–ü—Ä–æ–¥–æ–ª–∂–∏ —Å–æ Google", label_email: "–ï-–ø–æ—à—Ç–∞", label_password: "–õ–æ–∑–∏–Ω–∫–∞", btn_login: "–ù–∞—ò–∞–≤–∞", btn_no_account: "–ù–µ–º–∞—à —Å–º–µ—Ç–∫–∞?", label_displayname: "–ò–º–µ", label_phone: "–¢–µ–ª–µ—Ñ–æ–Ω", label_privacy: "–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç", opt_registered: "–°–∞–º–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω–∏", opt_public: "–à–∞–≤–Ω–æ", opt_hidden: "–°–∫—Ä–∏–µ–Ω–æ", toast_login_ok: "–£—Å–ø–µ—à–Ω–∞ –Ω–∞—ò–∞–≤–∞!", toast_reg_ok: "–°–º–µ—Ç–∫–∞—Ç–∞ –µ –∫—Ä–µ–∏—Ä–∞–Ω–∞!", toast_logout: "–û–¥—ò–∞–≤–µ–Ω", toast_saved: "–ó–∞—á—É–≤–∞–Ω–æ!", toast_deleted: "–ò–∑–±—Ä–∏—à–∞–Ω–æ.", toast_published: "–û–±—ò–∞–≤–µ–Ω–æ!", toast_error: "–ì—Ä–µ—à–∫–∞: ", toast_wait: "–ü–æ—á–µ–∫–∞—ò—Ç–µ...", toast_fill_all: "–ü–æ–ø–æ–ª–Ω–µ—Ç–µ —Å–µ!", alert_delete: "–°–∏–≥—É—Ä–Ω–æ –±—Ä–∏—à–µ—ö–µ?", alert_remove_pic: "–¢—Ä–≥–Ω–∏ —Å–ª–∏–∫–∞?", alert_delete_acc: "–í–Ω–∏–º–∞–Ω–∏–µ: –°–∏—Ç–µ –æ–≥–ª–∞—Å–∏ —ú–µ –±–∏–¥–∞—Ç –∏–∑–±—Ä–∏—à–∞–Ω–∏! –ü—Ä–æ–¥–æ–ª–∂–∏?", btn_call: "üìû –à–∞–≤–∏ —Å–µ", btn_whatsapp: "üí¨ WhatsApp", lbl_seller: "–ü—Ä–æ–¥–∞–≤–∞—á –Ω–∞ ZONA", msg_no_phone: "–ù–µ–º–∞ –±—Ä–æ—ò.", msg_hidden_phone: "–ë—Ä–æ—ò–æ—Ç –µ —Å–∫—Ä–∏–µ–Ω.", lbl_sold: "–ü–†–û–î–ê–î–ï–ù–û", lbl_reserved: "–†–ï–ó–ï–†–í–ò–†–ê–ù–û", lbl_active: "–ê–ö–¢–ò–í–ù–û", lbl_member_since: "–ß–ª–µ–Ω –æ–¥", title_report: "–ü—Ä–∏—ò–∞–≤–∏", desc_report: "–ó–æ—à—Ç–æ –ø—Ä–∏—ò–∞–≤—É–≤–∞—à?", btn_submit_report: "–ü—Ä–∏—ò–∞–≤–∏", lnk_impressum: "–ò–º–ø—Ä–µ—Å—É–º", lnk_privacy: "–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç",
        imprint_title: "–ò–º–ø—Ä–µ—Å—É–º", privacy_title: "–ü–æ–ª–∏—Ç–∏–∫–∞ –∑–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç" }
    };

    const COUNTRIES_DATA = { all: { de: "Alle", en: "All", sq: "T√´ gjitha", sr: "Sve", mk: "–°–∏—Ç–µ" }, al: { de: "Albanien", en: "Albania", sq: "Shqip√´ria", sr: "Albanija", mk: "–ê–ª–±–∞–Ω–∏—ò–∞" }, xk: { de: "Kosovo", en: "Kosovo", sq: "Kosova", sr: "Kosovo", mk: "–ö–æ—Å–æ–≤–æ" }, mk: { de: "Nordmazedonien", en: "North Macedonia", sq: "Maqedonia e V.", sr: "Severna Makedonija", mk: "–°–µ–≤–µ—Ä–Ω–∞ –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞" }, rs: { de: "Serbien", en: "Serbia", sq: "Serbia", sr: "Srbija", mk: "–°—Ä–±–∏—ò–∞" }, ba: { de: "Bosnien & Herz.", en: "Bosnia & Herz.", sq: "Bosnja", sr: "Bosna", mk: "–ë–æ—Å–Ω–∞" }, hr: { de: "Kroatien", en: "Croatia", sq: "Kroacia", sr: "Hrvatska", mk: "–•—Ä–≤–∞—Ç—Å–∫–∞" }, me: { de: "Montenegro", en: "Montenegro", sq: "Mali i Zi", sr: "Crna Gora", mk: "–¶—Ä–Ω–∞ –ì–æ—Ä–∞" } };

    const CATEGORIES_DATA = {
      vehicles: { label: { de: "Fahrzeuge", en: "Vehicles", sq: "Automjete", sr: "Vozila", mk: "–í–æ–∑–∏–ª–∞" }, subs: [{k:"small",de:"Kleinwagen"},{k:"limo",de:"Limousine"},{k:"wagon",de:"Kombi"},{k:"suv",de:"SUV"},{k:"coupe",de:"Sport/Coupe"},{k:"cabrio",de:"Cabrio"},{k:"moto",de:"Motorrad"},{k:"truck",de:"Nutzfahrzeug"}], filters: [{id:"filter_km"},{id:"filter_year"},{id:"filter_power"}] },
      realestate: { label: { de: "Immobilien", en: "Real Estate", sq: "Patundshm√´ri", sr: "Nekretnine", mk: "–ù–µ–¥–≤–∏–∂–Ω–æ—Å—Ç–∏" }, subs: [{k:"apt_buy",de:"Wohnung (Kauf)"},{k:"apt_rent",de:"Wohnung (Miete)"},{k:"house_buy",de:"Haus (Kauf)"},{k:"house_rent",de:"Haus (Miete)"},{k:"land",de:"Grundst√ºck"},{k:"comm",de:"Gewerbe"},{k:"garage",de:"Garage"}], filters: [{id:"filter_area"}] },
      electronics: { label: { de: "Elektronik", en: "Electronics", sq: "Elektronik√´", sr: "Elektronika", mk: "–ï–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞" }, subs: [{k:"phone",de:"Smartphone"},{k:"laptop",de:"Laptop/PC"},{k:"console",de:"Konsole"},{k:"tv",de:"TV/Audio"},{k:"cam",de:"Kamera"}], filters: [] },
      fashion: { label: { de: "Mode", en: "Fashion", sq: "Moda", sr: "Moda", mk: "–ú–æ–¥–∞" }, subs: [{k:"women",de:"Damen"},{k:"men",de:"Herren"},{k:"kids",de:"Kinder"},{k:"acc",de:"Accessoires"}], filters: [] },
      services: { label: { de: "Dienstleistung", en: "Services", sq: "Sh√´rbime", sr: "Usluge", mk: "–£—Å–ª—É–≥–∏" }, subs: [{k:"craft",de:"Handwerk"},{k:"trans",de:"Transport"},{k:"tech",de:"IT/Tech"},{k:"edu",de:"Unterricht"}], filters: [] },
      home: { label: { de: "Haus & Garten", en: "Home & Garden", sq: "Sht√´pia", sr: "Kuƒáa", mk: "–î–æ–º" }, subs: [{k:"furn",de:"M√∂bel"},{k:"kitchen",de:"K√ºche"},{k:"garden",de:"Garten"},{k:"deco",de:"Deko"}], filters: [] }
    };

    // --- MAIN APP ---
    
    // --- LEGAL CONTENT (per language) ---
    const LEGAL_CONTENT = {
      de: {
        imprint: `
          <p><strong>Betreiber</strong><br>
          Irajet Ramadani<br>
          Sandackerstrasse 7<br>
          9245 Oberb√ºren SG<br>
          Schweiz</p>

          <p><strong>Kontakt</strong><br>
          <a href="mailto:Irajet.ramadani@gmail.com">Irajet.ramadani@gmail.com</a><br>
          <span class="registered-only" data-display="inline">Telefon: <a href="tel:+41764843486">+41 76 484 34 86</a></span></p>

          <p><strong>Haftungsausschluss</strong><br>
          Die Inhalte dieser Plattform werden mit angemessener Sorgfalt erstellt. F√ºr die Richtigkeit, Vollst√§ndigkeit und Aktualit√§t der Inhalte √ºbernehmen wir jedoch keine Gew√§hr.
          F√ºr Inhalte und Angebote von Nutzerinnen und Nutzern (z. B. Inserate, Bilder, Beschreibungen) sind ausschliesslich die jeweiligen Anbieter verantwortlich.</p>

          <p><strong>Urheberrecht</strong><br>
          Inhalte und Werke auf dieser Website unterliegen dem Urheberrecht. Eine Weiterverwendung ausserhalb der Grenzen des Urheberrechts bedarf der vorg√§ngigen Zustimmung der Rechteinhaber.</p>

          <p class="muted">Stand: 31.01.2026</p>
        `,
        privacy: `
          <p class="muted">Stand: 31.01.2026</p>

          <h3>1. Verantwortliche Stelle</h3>
          <p>Irajet Ramadani, Sandackerstrasse 7, 9245 Oberb√ºren SG, Schweiz<br>
          E-Mail: <a href="mailto:Irajet.ramadani@gmail.com">Irajet.ramadani@gmail.com</a></p>

          <h3>2. Zweck dieser Datenschutzerkl√§rung</h3>
          <p>Diese Datenschutzerkl√§rung erl√§utert, welche Personendaten wir im Zusammenhang mit dem Betrieb des Marktplatzes verarbeiten und zu welchen Zwecken.</p>

          <h3>3. Welche Daten wir verarbeiten</h3>
          <ul>
            <li><strong>Account- und Anmeldedaten:</strong> E-Mail-Adresse, Firebase-User-ID (UID), Login-Status; bei Google-Login ggf. Name und Profilbild, soweit von Google bereitgestellt.</li>
            <li><strong>Profildaten:</strong> Anzeigename, Telefonnummer (optional) und deine Privatsph√§re-Einstellung.</li>
            <li><strong>Inserate & Inhalte:</strong> Titel, Preis, Land/Kategorie, Beschreibung sowie von dir hochgeladene Fotos (in der App als Bilddaten gespeichert).</li>
            <li><strong>Technische Daten:</strong> Ger√§te-/Browserinformationen und Logdaten, die bei der Nutzung unserer Infrastruktur anfallen (z. B. IP-Adresse in Server-Logs des Hosting-/Cloud-Providers).</li>
            <li><strong>Lokale App-Daten:</strong> Einstellungen im Browser (z. B. Theme/Sprache via localStorage).</li>
          </ul>

          <h3>4. Wof√ºr wir die Daten verwenden</h3>
          <ul>
            <li>Bereitstellung der Plattform-Funktionen (Login, Profil, Inserate, Verwaltung).</li>
            <li>Missbrauchs- und Sicherheitspr√§vention (z. B. Schutz vor Spam/Manipulation).</li>
            <li>Kommunikation bei Support-Anfragen.</li>
          </ul>

          <h3>5. Keine Analytics / kein Newsletter / keine Payments</h3>
          <p>Wir verwenden gem√§ss aktuellem Setup keine Analytics- oder Tracking-Tools und versenden keine Newsletter. Zahlungsabwicklung ist derzeit nicht integriert.</p>

          <h3>6. Empf√§nger und Dienstleister (Firebase / Google)</h3>
          <p>F√ºr Authentifizierung und Datenspeicherung nutzen wir Firebase (Google). Dabei k√∂nnen Personendaten in Rechenzentren ausserhalb der Schweiz verarbeitet werden.
          Wir achten auf angemessene datenschutzrechtliche Garantien (z. B. Standardvertragsklauseln, soweit anwendbar).</p>

          <h3>7. Speicherdauer</h3>
          <p>Personendaten werden grunds√§tzlich <strong>bis zur L√∂schung</strong> gespeichert. Wenn du dein Konto oder Inhalte l√∂schst, werden diese danach im Regelfall direkt entfernt (vorbeh√§ltlich technischer L√∂sch- und Backup-Zyklen des Cloud-Providers).</p>

          <h3>8. Deine Rechte</h3>
          <p>Du kannst Auskunft, Berichtigung oder L√∂schung deiner Personendaten verlangen. Bei Fragen oder Anliegen kontaktiere uns unter der oben genannten E-Mail-Adresse.</p>

          <h3>9. Datensicherheit</h3>
          <p>Wir treffen angemessene technische und organisatorische Massnahmen, um Daten vor unbefugtem Zugriff, Verlust oder Missbrauch zu sch√ºtzen. Ein vollst√§ndiger Schutz kann jedoch nicht garantiert werden.</p>

          <h3>10. √Ñnderungen</h3>
          <p>Wir k√∂nnen diese Datenschutzerkl√§rung bei Bedarf aktualisieren.</p>

<h3>11. EU/EWR: Rechte nach DSGVO</h3>
          <p>Wenn du dich in der EU/dem EWR befindest, gelten zus√§tzlich die Rechte gem√§ss DSGVO, u. a.:</p>
          <ul>
            <li>Auskunft, Berichtigung, L√∂schung</li>
            <li>Einschr√§nkung der Verarbeitung</li>
            <li>Daten√ºbertragbarkeit</li>
            <li>Widerspruch gegen Verarbeitungen auf Basis berechtigter Interessen</li>
            <li>Widerruf einer Einwilligung mit Wirkung f√ºr die Zukunft</li>
            <li>Beschwerde bei einer Datenschutz-Aufsichtsbeh√∂rde (insb. am Wohn-/Arbeitsort)</li>
          </ul>

          <h3>12. EU/EWR: Rechtsgrundlagen (DSGVO)</h3>
          <p>Sofern die DSGVO anwendbar ist, st√ºtzen wir die Verarbeitung insbesondere auf:</p>
          <ul>
            <li><strong>Art. 6 Abs. 1 lit. b DSGVO</strong> (Vertrag/Anbahnung) ‚Äì Betrieb von Konto, Inseraten und Plattformfunktionen.</li>
            <li><strong>Art. 6 Abs. 1 lit. f DSGVO</strong> (berechtigte Interessen) ‚Äì Sicherheit, Missbrauchspr√§vention, technische Stabilit√§t.</li>
            <li><strong>Art. 6 Abs. 1 lit. a DSGVO</strong> (Einwilligung) ‚Äì freiwillige Profilangaben (z. B. Telefonnummer), soweit du sie setzt.</li>
          </ul>

          <h3>13. Telefonnummern ‚Äì Sichtbarkeit</h3>
          <p>Telefonnummern (z. B. f√ºr Anruf/WhatsApp) werden in der App <strong>nur registrierten Nutzerinnen und Nutzern</strong> zug√§nglich gemacht. Du kannst deine Telefonnummer im Profil zus√§tzlich verbergen.</p>

        `
      },

      en: {
        imprint: `
          <p><strong>Operator</strong><br>
          Irajet Ramadani<br>
          Sandackerstrasse 7<br>
          9245 Oberb√ºren SG<br>
          Switzerland</p>

          <p><strong>Contact</strong><br>
          <a href="mailto:Irajet.ramadani@gmail.com">Irajet.ramadani@gmail.com</a><br>
          <span class="registered-only" data-display="inline">Phone: <a href="tel:+41764843486">+41 76 484 34 86</a></span></p>

          <p><strong>Disclaimer</strong><br>
          We create content with reasonable care, but do not guarantee accuracy, completeness or timeliness.
          Users are solely responsible for their own content (e.g., listings, images, descriptions).</p>

          <p><strong>Copyright</strong><br>
          Content and works on this website are subject to copyright. Any use beyond applicable limits requires permission from the rights holders.</p>

          <p class="muted">Last updated: 31.01.2026</p>
        `,
        privacy: `
          <p class="muted">Last updated: 31.01.2026</p>

          <h3>1. Controller</h3>
          <p>Irajet Ramadani, Sandackerstrasse 7, 9245 Oberb√ºren SG, Switzerland<br>
          Email: <a href="mailto:Irajet.ramadani@gmail.com">Irajet.ramadani@gmail.com</a></p>

          <h3>2. Scope</h3>
          <p>This policy explains which personal data we process when operating the marketplace and for what purposes.</p>

          <h3>3. Data we process</h3>
          <ul>
            <li><strong>Account & login:</strong> email address, Firebase user ID (UID), login status; for Google sign-in, possibly name and profile picture provided by Google.</li>
            <li><strong>Profile data:</strong> display name, phone number (optional) and your privacy setting.</li>
            <li><strong>Listings & content:</strong> title, price, country/category, description and photos you upload (stored as image data in the app).</li>
            <li><strong>Technical data:</strong> device/browser data and logs (e.g., IP address in server logs of the hosting/cloud provider).</li>
            <li><strong>Local app data:</strong> settings stored in your browser (e.g., theme/language via localStorage).</li>
          </ul>

          <h3>4. Purposes</h3>
          <ul>
            <li>Provide core features (sign-in, profile, listings, admin tools).</li>
            <li>Security and abuse prevention.</li>
            <li>Support communication.</li>
          </ul>

          <h3>5. No analytics / no newsletter / no payments</h3>
          <p>We currently do not use analytics or tracking tools and do not send newsletters. Payments are not integrated at this time.</p>

          <h3>6. Processors (Firebase / Google)</h3>
          <p>We use Firebase (Google) for authentication and data storage. Data may be processed outside Switzerland.
          We rely on appropriate safeguards where applicable (e.g., Standard Contractual Clauses).</p>

          <h3>7. Retention</h3>
          <p>Data is stored <strong>until deletion</strong>. When you delete your account or content, it is generally removed immediately (subject to technical deletion and backup cycles of the cloud provider).</p>

          <h3>8. Your rights</h3>
          <p>You may request access, correction or deletion of your data. Contact us via the email above.</p>

          <h3>9. Security</h3>
          <p>We apply reasonable technical and organisational measures to protect data. Absolute security cannot be guaranteed.</p>

          <h3>10. Changes</h3>
          <p>We may update this policy from time to time.</p>

          <p class="muted">Convenience translation. The German version prevails.</p>

<h3>11. EU/EEA: Your rights under the GDPR</h3>
          <p>If you are located in the EU/EEA, the GDPR applies in addition. This includes, among others:</p>
          <ul>
            <li>Right of access, rectification, erasure</li>
            <li>Restriction of processing</li>
            <li>Data portability</li>
            <li>Objection to processing based on legitimate interests</li>
            <li>Withdrawal of consent with effect for the future</li>
            <li>Right to lodge a complaint with a supervisory authority (especially where you live/work)</li>
          </ul>

          <h3>12. EU/EEA: Legal bases (GDPR)</h3>
          <p>Where the GDPR applies, we mainly rely on:</p>
          <ul>
            <li><strong>Art. 6(1)(b) GDPR</strong> (contract/pre-contract) ‚Äì operating accounts, listings and platform features.</li>
            <li><strong>Art. 6(1)(f) GDPR</strong> (legitimate interests) ‚Äì security, fraud/spam prevention, technical stability.</li>
            <li><strong>Art. 6(1)(a) GDPR</strong> (consent) ‚Äì optional profile data (e.g., phone number) if you provide it.</li>
          </ul>

          <h3>13. Phone numbers ‚Äì visibility</h3>
          <p>Phone numbers (e.g., for call/WhatsApp) are made available <strong>only to registered users</strong> within the app. You can also hide your phone number in your profile.</p>

        `
      },

      // Convenience translations; German remains authoritative.
      sq: { imprint: `
          <p><strong>Operatori</strong><br>
          Irajet Ramadani<br>
          Sandackerstrasse 7<br>
          9245 Oberb√ºren SG<br>
          Zvic√´r</p>

          <p><strong>Kontakt</strong><br>
          <a href="mailto:Irajet.ramadani@gmail.com">Irajet.ramadani@gmail.com</a><br>
          <span class="registered-only" data-display="inline">Telefon: <a href="tel:+41764843486">+41 76 484 34 86</a></span></p>

          <p><strong>P√´rgjegj√´sia</strong><br>
          P√´rmbajtja p√´rgatitet me kujdes t√´ arsyesh√´m, por nuk garantojm√´ sakt√´sin√´, plot√´sin√´ ose aktualitetin.
          P√´rdoruesit jan√´ p√´rgjegj√´s p√´r p√´rmbajtjen e tyre (p.sh. njoftime, foto, p√´rshkrime).</p>

          <p><strong>E drejta e autorit</strong><br>
          P√´rmbajtjet dhe veprat n√´ k√´t√´ faqe mbrohen nga e drejta e autorit. P√´rdorimi jasht√´ kufijve ligjor√´ k√´rkon leje nga mbajt√´sit e t√´ drejtave.</p>

          <p class="muted">P√´rdit√´suar m√´: 31.01.2026. Versioni gjerman √´sht√´ vendimtar.</p>
`, privacy: `
          <p class="muted">P√´rdit√´suar m√´: 31.01.2026. Versioni gjerman √´sht√´ vendimtar.</p>

          <h3>1. P√´rgjegj√´si</h3>
          <p>Irajet Ramadani, Sandackerstrasse 7, 9245 Oberb√ºren SG, Zvic√´r<br>
          E-mail: <a href="mailto:Irajet.ramadani@gmail.com">Irajet.ramadani@gmail.com</a></p>

          <h3>2. Q√´llimi</h3>
          <p>Kjo politik√´ shpjegon cilat t√´ dh√´na personale p√´rpunojm√´ gjat√´ operimit t√´ tregut online dhe p√´r √ßfar√´ q√´llimesh.</p>

          <h3>3. T√´ dh√´nat q√´ p√´rpunojm√´</h3>
          <ul>
            <li><strong>Llogaria & hyrja:</strong> adresa e email-it, UID (Firebase), statusi i hyrjes; me Google sign-in mund t√´ merret emri/fotoja e profilit (n√´se ofrohet nga Google).</li>
            <li><strong>Profili:</strong> emri i shfaqjes, numri i telefonit (opsional) dhe cil√´simi i privat√´sis√´.</li>
            <li><strong>Njoftime & p√´rmbajtje:</strong> titulli, √ßmimi, vendi/kategoria, p√´rshkrimi dhe fotot e ngarkuara.</li>
            <li><strong>T√´ dh√´na teknike:</strong> t√´ dh√´na t√´ pajisjes/shfletuesit dhe log-e (p.sh. IP n√´ log-e t√´ ofruesit cloud).</li>
            <li><strong>T√´ dh√´na lokale:</strong> cil√´sime n√´ shfletues (p.sh. tema/gjuha via localStorage).</li>
          </ul>

          <h3>4. Q√´llimet e p√´rpunimit</h3>
          <ul>
            <li>Ofrimi i funksioneve (hyrje, profil, njoftime, menaxhim).</li>
            <li>Siguria dhe parandalimi i abuzimit.</li>
            <li>Komunikim p√´r mb√´shtetje.</li>
          </ul>

          <h3>5. Pa analytics / pa newsletter / pa pagesa</h3>
          <p>Aktualisht nuk p√´rdorim mjete analytics/tracking dhe nuk d√´rgojm√´ newsletter. Pagesat nuk jan√´ t√´ integruara.</p>

          <h3>6. Sh√´rbime t√´ jashtme (Firebase / Google)</h3>
          <p>P√´rdorim Firebase (Google) p√´r autentikim dhe ruajtje t√´ t√´ dh√´nave. T√´ dh√´nat mund t√´ p√´rpunohen jasht√´ Zvicr√´s.
          Aty ku aplikohet, mb√´shtetemi n√´ garanci t√´ p√´rshtatshme (p.sh. klauzola standarde kontraktuale).</p>

          <h3>7. Ruajtja</h3>
          <p>T√´ dh√´nat ruhen <strong>deri n√´ fshirje</strong>. Pas fshirjes s√´ llogaris√´ ose p√´rmbajtjes, ato hiqen zakonisht menj√´her√´ (duke marr√´ parasysh ciklet teknike/backup t√´ cloud-it).</p>

          <h3>8. T√´ drejtat</h3>
          <p>Mund t√´ k√´rkoni qasje, korrigjim ose fshirje t√´ t√´ dh√´nave. Na kontaktoni me email.</p>

          <h3>9. Siguria</h3>
          <p>Zbatojm√´ masa t√´ arsyeshme teknike dhe organizative, por siguria absolute nuk mund t√´ garantohet.</p>
` },
      sr: { imprint: `
          <p><strong>Operator</strong><br>
          Irajet Ramadani<br>
          Sandackerstrasse 7<br>
          9245 Oberb√ºren SG<br>
          ≈†vajcarska</p>

          <p><strong>Kontakt</strong><br>
          <a href="mailto:Irajet.ramadani@gmail.com">Irajet.ramadani@gmail.com</a><br>
          <span class="registered-only" data-display="inline">Telefon: <a href="tel:+41764843486">+41 76 484 34 86</a></span></p>

          <p><strong>Odricanje od odgovornosti</strong><br>
          Sadr≈æaj pripremamo sa razumnom pa≈ænjom, ali ne garantujemo taƒçnost, potpunost ili a≈æurnost.
          Korisnici su iskljuƒçivo odgovorni za sopstveni sadr≈æaj (npr. oglase, slike, opise).</p>

          <p><strong>Autorska prava</strong><br>
          Sadr≈æaji i dela na ovoj stranici su za≈°tiƒáeni autorskim pravom. Kori≈°ƒáenje izvan zakonskih okvira zahteva dozvolu nosilaca prava.</p>

          <p class="muted">A≈æurirano: 31.01.2026. Nemaƒçka verzija je merodavna.</p>
`, privacy: `
          <p class="muted">A≈æurirano: 31.01.2026. Nemaƒçka verzija je merodavna.</p>

          <h3>1. Rukovalac (odgovorno lice)</h3>
          <p>Irajet Ramadani, Sandackerstrasse 7, 9245 Oberb√ºren SG, ≈†vajcarska<br>
          Email: <a href="mailto:Irajet.ramadani@gmail.com">Irajet.ramadani@gmail.com</a></p>

          <h3>2. Svrha</h3>
          <p>Ova politika obja≈°njava koje liƒçne podatke obraƒëujemo prilikom rada marketplace-a i u koje svrhe.</p>

          <h3>3. Podaci koje obraƒëujemo</h3>
          <ul>
            <li><strong>Nalog i prijava:</strong> email adresa, Firebase UID, status prijave; kod Google prijave mogu se preuzeti ime i profilna slika (ako ih Google prosledi).</li>
            <li><strong>Profil:</strong> prikazno ime, broj telefona (opciono) i pode≈°avanje privatnosti.</li>
            <li><strong>Oglasi i sadr≈æaj:</strong> naslov, cena, dr≈æava/kategorija, opis i fotografije koje otpremite.</li>
            <li><strong>Tehniƒçki podaci:</strong> podaci o ureƒëaju/pregledaƒçu i logovi (npr. IP adresa u logovima cloud provajdera).</li>
            <li><strong>Lokalni podaci aplikacije:</strong> pode≈°avanja u pregledaƒçu (npr. tema/jezik preko localStorage).</li>
          </ul>

          <h3>4. Svrhe obrade</h3>
          <ul>
            <li>Obezbeƒëivanje funkcionalnosti (prijava, profil, oglasi, upravljanje).</li>
            <li>Bezbednost i spreƒçavanje zloupotrebe.</li>
            <li>Komunikacija za podr≈°ku.</li>
          </ul>

          <h3>5. Nema analytics / nema newsletter / nema plaƒáanja</h3>
          <p>Trenutno ne koristimo analytics/tracking alate i ne ≈°aljemo newsletter. Plaƒáanja nisu integrisana.</p>

          <h3>6. Pru≈æaoci usluga (Firebase / Google)</h3>
          <p>Koristimo Firebase (Google) za autentifikaciju i skladi≈°tenje podataka. Podaci se mogu obraƒëivati van ≈†vajcarske.
          Gde je primenljivo, oslanjamo se na odgovarajuƒáe za≈°titne mere (npr. standardne ugovorne klauzule).</p>

          <h3>7. Period ƒçuvanja</h3>
          <p>Podaci se ƒçuvaju <strong>do brisanja</strong>. Nakon brisanja naloga ili sadr≈æaja, podaci se u pravilu uklanjaju odmah (uz tehniƒçke backup/cycle procese cloud provajdera).</p>

          <h3>8. Va≈°a prava</h3>
          <p>Mo≈æete tra≈æiti pristup, ispravku ili brisanje podataka. Kontaktirajte nas putem email-a.</p>

          <h3>9. Bezbednost</h3>
          <p>Primjenjujemo razumne tehniƒçke i organizacione mjere, ali apsolutna sigurnost nije moguƒáa.</p>
` },
      mk: { imprint: `
          <p><strong>–û–ø–µ—Ä–∞—Ç–æ—Ä</strong><br>
          Irajet Ramadani<br>
          Sandackerstrasse 7<br>
          9245 Oberb√ºren SG<br>
          –®–≤–∞—ò—Ü–∞—Ä–∏—ò–∞</p>

          <p><strong>–ö–æ–Ω—Ç–∞–∫—Ç</strong><br>
          <a href="mailto:Irajet.ramadani@gmail.com">Irajet.ramadani@gmail.com</a><br>
          <span class="registered-only" data-display="inline">–¢–µ–ª–µ—Ñ–æ–Ω: <a href="tel:+41764843486">+41 76 484 34 86</a></span></p>

          <p><strong>–û–¥—Ä–µ–∫—É–≤–∞—ö–µ –æ–¥ –æ–¥–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç</strong><br>
          –°–æ–¥—Ä–∂–∏–Ω–∏—Ç–µ –≥–∏ –ø–æ–¥–≥–æ—Ç–≤—É–≤–∞–º–µ —Å–æ —Ä–∞–∑—É–º–Ω–∞ –≤–Ω–∏–º–∞—Ç–µ–ª–Ω–æ—Å—Ç, –Ω–æ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞–º–µ —Ç–æ—á–Ω–æ—Å—Ç, —Ü–µ–ª–æ—Å–Ω–æ—Å—Ç –∏–ª–∏ –∞–∂—É—Ä–Ω–æ—Å—Ç.
          –ö–æ—Ä–∏—Å–Ω–∏—Ü–∏—Ç–µ —Å–µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–æ –æ–¥–≥–æ–≤–æ—Ä–Ω–∏ –∑–∞ —Å–æ–ø—Å—Ç–≤–µ–Ω–∞—Ç–∞ —Å–æ–¥—Ä–∂–∏–Ω–∞ (–Ω–∞ –ø—Ä. –æ–≥–ª–∞—Å–∏, —Å–ª–∏–∫–∏, –æ–ø–∏—Å–∏).</p>

          <p><strong>–ê–≤—Ç–æ—Ä—Å–∫–∏ –ø—Ä–∞–≤–∞</strong><br>
          –°–æ–¥—Ä–∂–∏–Ω–∏—Ç–µ –∏ –¥–µ–ª–∞—Ç–∞ –Ω–∞ –æ–≤–∞–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–µ –∑–∞—à—Ç–∏—Ç–µ–Ω–∏ —Å–æ –∞–≤—Ç–æ—Ä—Å–∫–æ –ø—Ä–∞–≤–æ. –ö–æ—Ä–∏—Å—Ç–µ—ö–µ –Ω–∞–¥–≤–æ—Ä –æ–¥ –∑–∞–∫–æ–Ω—Å–∫–∏—Ç–µ —Ä–∞–º–∫–∏ –±–∞—Ä–∞ –¥–æ–∑–≤–æ–ª–∞ –æ–¥ –Ω–æ—Å–∏—Ç–µ–ª–∏—Ç–µ –Ω–∞ –ø—Ä–∞–≤–∞—Ç–∞.</p>

          <p class="muted">–ê–∂—É—Ä–∏—Ä–∞–Ω–æ: 31.01.2026. –ì–µ—Ä–º–∞–Ω—Å–∫–∞—Ç–∞ –≤–µ—Ä–∑–∏—ò–∞ –µ –º–µ—Ä–æ–¥–∞–≤–Ω–∞.</p>
`, privacy: `
          <p class="muted">–ê–∂—É—Ä–∏—Ä–∞–Ω–æ: 31.01.2026. –ì–µ—Ä–º–∞–Ω—Å–∫–∞—Ç–∞ –≤–µ—Ä–∑–∏—ò–∞ –µ –º–µ—Ä–æ–¥–∞–≤–Ω–∞.</p>

          <h3>1. –û–¥–≥–æ–≤–æ—Ä–Ω–æ –ª–∏—Ü–µ</h3>
          <p>Irajet Ramadani, Sandackerstrasse 7, 9245 Oberb√ºren SG, –®–≤–∞—ò—Ü–∞—Ä–∏—ò–∞<br>
          –ï-–ø–æ—à—Ç–∞: <a href="mailto:Irajet.ramadani@gmail.com">Irajet.ramadani@gmail.com</a></p>

          <h3>2. –û–ø—Å–µ–≥</h3>
          <p>–û–≤–∞–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ –æ–±—ò–∞—Å–Ω—É–≤–∞ –∫–æ–∏ –ª–∏—á–Ω–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏ –≥–∏ –æ–±—Ä–∞–±–æ—Ç—É–≤–∞–º–µ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ—ö–µ—Ç–æ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ—ò—Å–æ—Ç –∏ –∑–∞ –∫–æ–∏ —Ü–µ–ª–∏.</p>

          <h3>3. –ü–æ–¥–∞—Ç–æ—Ü–∏ —à—Ç–æ –≥–∏ –æ–±—Ä–∞–±–æ—Ç—É–≤–∞–º–µ</h3>
          <ul>
            <li><strong>–°–º–µ—Ç–∫–∞ –∏ –Ω–∞—ò–∞–≤–∞:</strong> –µ-–ø–æ—à—Ç–∞, Firebase UID, —Å—Ç–∞—Ç—É—Å –Ω–∞ –Ω–∞—ò–∞–≤–∞; –ø—Ä–∏ Google –Ω–∞—ò–∞–≤–∞ –º–æ–∂–Ω–∏ —Å–µ –∏–º–µ –∏ –ø—Ä–æ—Ñ–∏–ª–Ω–∞ —Å–ª–∏–∫–∞ (–∞–∫–æ –≥–∏ –¥–æ—Å—Ç–∞–≤–∏ Google).</li>
            <li><strong>–ü—Ä–æ—Ñ–∏–ª:</strong> –ø—Ä–∏–∫–∞–∂–∞–Ω–æ –∏–º–µ, —Ç–µ–ª–µ—Ñ–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ) –∏ –ø–æ—Å—Ç–∞–≤–∫–∞ –∑–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç.</li>
            <li><strong>–û–≥–ª–∞—Å–∏ –∏ —Å–æ–¥—Ä–∂–∏–Ω–∞:</strong> –Ω–∞—Å–ª–æ–≤, —Ü–µ–Ω–∞, –¥—Ä–∂–∞–≤–∞/–∫–∞—Ç–µ–≥–æ—Ä–∏—ò–∞, –æ–ø–∏—Å –∏ –æ—Ç–ø—Ä–µ–º–µ–Ω–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏.</li>
            <li><strong>–¢–µ—Ö–Ω–∏—á–∫–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏:</strong> –ø–æ–¥–∞—Ç–æ—Ü–∏ –∑–∞ —É—Ä–µ–¥/–ø—Ä–µ–ª–∏—Å—Ç—É–≤–∞—á –∏ –ª–æ–≥–æ–≤–∏ (–Ω–∞ –ø—Ä. IP –≤–æ –ª–æ–≥–æ–≤–∏ –Ω–∞ cloud –ø—Ä–æ–≤–∞—ò–¥–µ—Ä).</li>
            <li><strong>–õ–æ–∫–∞–ª–Ω–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏:</strong> –ø–æ—Å—Ç–∞–≤–∫–∏ –≤–æ –ø—Ä–µ–ª–∏—Å—Ç—É–≤–∞—á (–Ω–∞ –ø—Ä. —Ç–µ–º–∞/—ò–∞–∑–∏–∫ –ø—Ä–µ–∫—É localStorage).</li>
          </ul>

          <h3>4. –¶–µ–ª–∏</h3>
          <ul>
            <li>–û–±–µ–∑–±–µ–¥—É–≤–∞—ö–µ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏—Ç–µ (–Ω–∞—ò–∞–≤–∞, –ø—Ä–æ—Ñ–∏–ª, –æ–≥–ª–∞—Å–∏, —É–ø—Ä–∞–≤—É–≤–∞—ö–µ).</li>
            <li>–ë–µ–∑–±–µ–¥–Ω–æ—Å—Ç –∏ —Å–ø—Ä–µ—á—É–≤–∞—ö–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–∏.</li>
            <li>–ö–æ–º—É–Ω–∏–∫–∞—Ü–∏—ò–∞ –∑–∞ –ø–æ–¥–¥—Ä—à–∫–∞.</li>
          </ul>

          <h3>5. –ë–µ–∑ analytics / –±–µ–∑ newsletter / –±–µ–∑ –ø–ª–∞—ú–∞—ö–∞</h3>
          <p>–ú–æ–º–µ–Ω—Ç–∞–ª–Ω–æ –Ω–µ –∫–æ—Ä–∏—Å—Ç–∏–º–µ analytics/tracking –∞–ª–∞—Ç–∫–∏ –∏ –Ω–µ –∏—Å–ø—Ä–∞—ú–∞–º–µ newsletter. –ü–ª–∞—ú–∞—ö–∞ –Ω–µ —Å–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–∞–Ω–∏.</p>

          <h3>6. –î–∞–≤–∞—Ç–µ–ª–∏ –Ω–∞ —É—Å–ª—É–≥–∏ (Firebase / Google)</h3>
          <p>–ö–æ—Ä–∏—Å—Ç–∏–º–µ Firebase (Google) –∑–∞ –∞–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—ò–∞ –∏ —Å–∫–ª–∞–¥–∏—Ä–∞—ö–µ. –ü–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ –º–æ–∂–µ –¥–∞ —Å–µ –æ–±—Ä–∞–±–æ—Ç—É–≤–∞–∞—Ç –Ω–∞–¥–≤–æ—Ä –æ–¥ –®–≤–∞—ò—Ü–∞—Ä–∏—ò–∞.
          –ö–∞–¥–µ —à—Ç–æ –µ –ø—Ä–∏–º–µ–Ω–ª–∏–≤–æ, —Å–µ –ø–æ—Ç–ø–∏—Ä–∞–º–µ –Ω–∞ —Å–æ–æ–¥–≤–µ—Ç–Ω–∏ –∑–∞—à—Ç–∏—Ç–Ω–∏ –º–µ—Ä–∫–∏ (–Ω–∞ –ø—Ä. —Å—Ç–∞–Ω–¥–∞—Ä–¥–Ω–∏ –¥–æ–≥–æ–≤–æ—Ä–Ω–∏ –∫–ª–∞—É–∑—É–ª–∏).</p>

          <h3>7. –ß—É–≤–∞—ö–µ</h3>
          <p>–ü–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ —Å–µ —á—É–≤–∞–∞—Ç <strong>–¥–æ –±—Ä–∏—à–µ—ö–µ</strong>. –ü–æ –±—Ä–∏—à–µ—ö–µ –Ω–∞ —Å–º–µ—Ç–∫–∞ –∏–ª–∏ —Å–æ–¥—Ä–∂–∏–Ω–∞, –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ –≤–æ–æ–±–∏—á–∞–µ–Ω–æ —Å–µ –æ—Ç—Å—Ç—Ä–∞–Ω—É–≤–∞–∞—Ç –≤–µ–¥–Ω–∞—à (—Å–æ –æ–≥–ª–µ–¥ –Ω–∞ —Ç–µ—Ö–Ω–∏—á–∫–∏ backup/—Ü–∏–∫–ª—É—Å–∏ –Ω–∞ cloud –ø—Ä–æ–≤–∞—ò–¥–µ—Ä–æ—Ç).</p>

          <h3>8. –í–∞—à–∏ –ø—Ä–∞–≤–∞</h3>
          <p>–ú–æ–∂–µ—Ç–µ –¥–∞ –ø–æ–±–∞—Ä–∞—Ç–µ –ø—Ä–∏—Å—Ç–∞–ø, –∏—Å–ø—Ä–∞–≤–∫–∞ –∏–ª–∏ –±—Ä–∏—à–µ—ö–µ. –ö–æ–Ω—Ç–∞–∫—Ç–∏—Ä–∞—ò—Ç–µ –Ω√® –ø—Ä–µ–∫—É –µ-–ø–æ—à—Ç–∞.</p>

          <h3>9. –ë–µ–∑–±–µ–¥–Ω–æ—Å—Ç</h3>
          <p>–ü—Ä–∏–º–µ–Ω—É–≤–∞–º–µ —Ä–∞–∑—É–º–Ω–∏ —Ç–µ—Ö–Ω–∏—á–∫–∏ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—Å–∫–∏ –º–µ—Ä–∫–∏, –Ω–æ –∞–ø—Å–æ–ª—É—Ç–Ω–∞ –±–µ–∑–±–µ–¥–Ω–æ—Å—Ç –Ω–µ –º–æ–∂–µ –¥–∞ —Å–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞.</p>
` }
    };

    // Fallback: if a language lacks legal text, use EN with note.
    const legalFallback = (lang, type) => {
      const L = LEGAL_CONTENT[lang] || {};
      if (L[type]) return L[type];
      return (LEGAL_CONTENT.en[type] || "") + `<p class="muted">Informative translation. The German version prevails.</p>`;
    };

window.app = {
      lang: 'de', user: null, authMode: 'login', uploadSlot: -1, images: [null, null, null, null],
      userData: { favorites: [] }, currentListing: null, currentSeller: null,

      t: (key) => TRANSLATIONS[app.lang][key] || key,

      init: () => {
        app.loadTheme();
        app.setLanguage('de'); 
        app.setupListeners();
        app.initAuthListener();
        app.loadListings();
            app.applyRegisteredOnlyVisibility();
        document.getElementById('upload-input').addEventListener('change', app.handleFileSelect);
        document.getElementById('avatar-input').addEventListener('change', app.handleAvatarUpload);
              app.bindLegalLinks();
},

      initAuthListener: () => {
        onAuthStateChanged(auth, async (user) => {
          app.user = user;
          const li = document.getElementById("profile-content-logged-in");
          const gu = document.getElementById("profile-content-guest");
          if (user) { 
            li.style.display = "block"; gu.style.display = "none"; 
            app.loadProfileData();
            app.applyRegisteredOnlyVisibility(); 
          } else { 
            li.style.display = "none"; gu.style.display = "block"; 
            app.userData = { favorites: [] };
            app.loadListings(); 
          }
        });
      },

      // --- AUTH ---
      openAuth: (mode) => {
        app.authMode = mode;
        document.getElementById('auth-modal').style.display = "flex";
        document.getElementById('auth-title').innerText = app.t(mode === 'login' ? 'btn_login' : 'btn_no_account');
      },
      closeModal: (id) => { document.getElementById(id).style.display = "none"; },

      applyRegisteredOnlyVisibility: () => {
        const isLoggedIn = !!app.user;
        document.querySelectorAll('.registered-only').forEach(el => {
          const disp = el.getAttribute('data-display') || 'block';
          el.style.display = isLoggedIn ? disp : 'none';
        });
      },

      openLegal: (type) => {
        if (type === 'imprint') {
          document.getElementById('imprint-content').innerHTML = legalFallback(app.lang, 'imprint');
          document.getElementById('imprint-modal').style.display = "flex";
          app.applyRegisteredOnlyVisibility();
        } else if (type === 'privacy') {
          document.getElementById('privacy-content').innerHTML = legalFallback(app.lang, 'privacy');
          document.getElementById('privacy-modal').style.display = "flex";
          app.applyRegisteredOnlyVisibility();
        }
      },

      
      handleAuth: async () => {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-pass').value;
        if(!email || !pass) { app.showToast(app.t('toast_fill_all')); return; }
        try {
          if (app.authMode === 'login') { await signInWithEmailAndPassword(auth, email, pass); app.showToast(app.t('toast_login_ok')); } 
          else { await createUserWithEmailAndPassword(auth, email, pass); app.showToast(app.t('toast_reg_ok')); }
          app.closeModal('auth-modal');
        } catch (error) { app.showToast(app.t('toast_error') + error.message); }
      },
      loginGoogle: async () => {
        try { await signInWithPopup(auth, googleProvider); app.showToast(app.t('toast_login_ok')); app.closeModal('auth-modal'); }
        catch (error) { app.showToast(app.t('toast_error') + error.message); }
      },
      logout: async () => { await signOut(auth); app.showToast(app.t('toast_logout')); window.location.reload(); },

      // --- PROFILE & WATCHLIST ---
      loadProfileData: async () => {
        if(!app.user) return;
        const ref = doc(db, "users", app.user.uid);
        const snap = await getDoc(ref);
        let data = {};
        if (snap.exists()) data = snap.data();
        else {
            data = { email: app.user.email, displayName: app.user.displayName, photoURL: app.user.photoURL, privacy: 'registered', favorites: [], createdAt: new Date(), ratingCount: 0, ratingAvg: 0 };
            await setDoc(ref, data, { merge: true });
        }
        app.userData = data;

        document.getElementById('dash-name').innerText = data.displayName || "User";
        document.getElementById('dash-email').innerText = data.email || "";
        const av = document.getElementById('dash-avatar');
        av.style.backgroundImage = data.photoURL ? `url(${data.photoURL})` : "none";
        av.innerText = data.photoURL ? "" : "üë§";
        
        if(app.user.emailVerified) document.getElementById('dash-verified').style.display = "inline-flex";
        
        const date = data.createdAt ? new Date(data.createdAt.seconds * 1000) : new Date();
        const dateStr = date.toLocaleDateString(app.lang, { year: 'numeric', month: 'long' });
        document.getElementById('dash-since').innerText = app.t('lbl_member_since') + " " + dateStr;

        const ratingEl = document.getElementById('dash-rating');
        const sepEl = document.getElementById('dash-separator');

        if (data.ratingCount && data.ratingCount > 0) {
            ratingEl.innerText = `${Number(data.ratingAvg).toFixed(1)} ‚òÖ (${data.ratingCount})`;
            ratingEl.style.display = "inline";
            sepEl.style.display = "inline";
        } else {
            ratingEl.style.display = "none";
            sepEl.style.display = "none";
        }

        document.getElementById('stat-watchlist').innerText = (data.favorites || []).length;

        const q = query(collection(db, "listings"), where("uid", "==", app.user.uid));
        const qSnap = await getDocs(q);
        document.getElementById('stat-listings').innerText = qSnap.size;
        
        const listContainer = document.getElementById('dash-listings-container');
        listContainer.innerHTML = "";
        qSnap.forEach(d => {
            const item = d.data();
            const div = document.createElement('div');
            div.className = "list-item";
            const statusLabel = item.status === 'sold' ? app.t('lbl_sold') : (item.status === 'reserved' ? app.t('lbl_reserved') : app.t('lbl_active'));
            div.innerHTML = `
              <div style="display:flex; flex-direction:column;">
                <span style="font-weight:600">${item.title}</span>
                <span style="font-size:12px; color:var(--text-secondary)">${item.price} ‚Ç¨ ‚Ä¢ ${statusLabel}</span>
              </div>
              <div style="display:flex; gap:5px;">
                <select style="font-size:11px; padding:2px;" onchange="app.changeStatus('${d.id}', this.value)">
                    <option value="active" ${!item.status || item.status=='active'?'selected':''}>${app.t('lbl_active')}</option>
                    <option value="reserved" ${item.status=='reserved'?'selected':''}>${app.t('lbl_reserved')}</option>
                    <option value="sold" ${item.status=='sold'?'selected':''}>${app.t('lbl_sold')}</option>
                </select>
                <button class="rai-btn danger small" onclick="app.deleteListing('${d.id}')">‚úï</button>
              </div>
            `;
            listContainer.appendChild(div);
        });
      },
      openWatchlist: async () => {
        if(!app.userData.favorites || app.userData.favorites.length === 0) { app.showToast(app.t('empty_results')); return; }
        const list = document.getElementById('my-listings-list');
        list.innerHTML = "";
        document.getElementById('modal-list-title').innerText = app.t('lbl_watchlist');
        for(const favId of app.userData.favorites) {
            const snap = await getDoc(doc(db, "listings", favId));
            if(snap.exists()) {
                const item = snap.data();
                const div = document.createElement('div');
                div.className = "rai-card"; div.style.padding="10px"; div.style.marginBottom="0";
                div.innerHTML = `<div onclick="app.openDetail('${favId}')" style="cursor:pointer;font-weight:bold;">${item.title}</div><div style="color:var(--accent)">${item.price} ‚Ç¨</div>`;
                list.appendChild(div);
            }
        }
        document.getElementById('my-listings-modal').style.display = "flex";
      },
      changeStatus: async (id, status) => {
        await updateDoc(doc(db, "listings", id), { status: status });
        app.showToast(app.t('toast_saved'));
      },
      toggleFav: async (e, id) => {
        e.stopPropagation();
        if(!app.user) { app.openAuth('login'); return; }
        const userRef = doc(db, "users", app.user.uid);
        if(app.userData.favorites && app.userData.favorites.includes(id)) {
            await updateDoc(userRef, { favorites: arrayRemove(id) });
            e.target.classList.remove('active'); e.target.innerHTML = "‚ô°";
        } else {
            await updateDoc(userRef, { favorites: arrayUnion(id) });
            e.target.classList.add('active'); e.target.innerHTML = "‚ô•";
        }
        app.loadProfileData();
            app.applyRegisteredOnlyVisibility(); 
      },
      openSettings: async () => {
        document.getElementById('set-name').value = app.userData.displayName || "";
        document.getElementById('set-phone').value = app.userData.phone || "";
        document.getElementById('set-privacy').value = app.userData.privacy || "registered";
        document.getElementById('settings-modal').style.display = "flex";
      },
      saveSettings: async () => {
        try {
            await setDoc(doc(db, "users", app.user.uid), { displayName: document.getElementById('set-name').value, phone: document.getElementById('set-phone').value, privacy: document.getElementById('set-privacy').value }, { merge: true });
            app.showToast(app.t('toast_saved')); app.closeModal('settings-modal'); app.loadProfileData();
            app.applyRegisteredOnlyVisibility();
        } catch(e) { app.showToast(app.t('toast_error')); }
      },
      triggerAvatarUpload: () => document.getElementById('avatar-input').click(),
      handleAvatarUpload: (e) => {
        const file = e.target.files[0]; if(!file) return;
        const reader = new FileReader(); reader.readAsDataURL(file);
        reader.onload = async (ev) => {
            const img = new Image(); img.src = ev.target.result;
            img.onload = async () => {
                const cvs = document.createElement('canvas'); const scale = 300 / img.width; cvs.width = 300; cvs.height = img.height * scale;
                const ctx = cvs.getContext('2d'); ctx.drawImage(img,0,0,cvs.width,cvs.height);
                await setDoc(doc(db, "users", app.user.uid), { photoURL: cvs.toDataURL('image/jpeg', 0.6) }, { merge: true });
                app.loadProfileData();
            app.applyRegisteredOnlyVisibility(); app.showToast(app.t('toast_saved'));
            };
        };
      },
      removeAvatar: async () => { if(!confirm(app.t('alert_remove_pic'))) return; await setDoc(doc(db, "users", app.user.uid), { photoURL: null }, { merge: true }); app.loadProfileData();
            app.applyRegisteredOnlyVisibility(); },
      deleteListing: async (id) => { if(!confirm(app.t('alert_delete'))) return; await deleteDoc(doc(db, "listings", id)); app.showToast(app.t('toast_deleted')); app.loadProfileData();
            app.applyRegisteredOnlyVisibility(); app.loadListings(); },
      deleteAccount: async () => {
        if(!confirm(app.t('alert_delete_acc'))) return;
        app.showToast(app.t('toast_wait'));
        const q = query(collection(db, "listings"), where("uid", "==", app.user.uid));
        const snap = await getDocs(q);
        snap.forEach(async (d) => await deleteDoc(d.ref));
        await deleteDoc(doc(db, "users", app.user.uid));
        await deleteUser(app.user);
        alert(app.t('toast_deleted')); window.location.reload();
      },

      // --- DETAIL & REPORT ---
      openDetail: async (id) => {
        const snap = await getDoc(doc(db, "listings", id));
        if(!snap.exists()) return;
        const data = snap.data();
        if(data.status === 'sold') { app.showToast(app.t('lbl_sold')); return; } 
        app.currentListing = { id: id, ...data };
        
        const sellerSnap = await getDoc(doc(db, "users", data.uid));
        app.currentSeller = sellerSnap.exists() ? sellerSnap.data() : {};

        document.getElementById('detail-title').innerText = data.title;
        document.getElementById('detail-price').innerText = `‚Ç¨ ${data.price}`;
        document.getElementById('detail-desc').innerText = data.desc;
        document.getElementById('detail-loc').innerText = data.country;
        document.getElementById('detail-cat').innerText = data.category;
        document.getElementById('detail-date').innerText = new Date(data.createdAt.seconds * 1000).toLocaleDateString();
        
        const imgBox = document.getElementById('detail-img-box');
        imgBox.innerHTML = data.image ? `<img src="${data.image}">` : `<div style="height:100%;display:flex;align-items:center;justify-content:center;font-size:50px;">üì∑</div>`;

        document.getElementById('detail-seller-name').innerText = app.currentSeller.displayName || "User";
        const av = document.getElementById('detail-seller-av');
        av.style.backgroundImage = app.currentSeller.photoURL ? `url(${app.currentSeller.photoURL})` : "none";
        av.innerText = app.currentSeller.photoURL ? "" : "üë§";

        document.getElementById('detail-modal').style.display = "flex";
      },
      openReport: () => {
        document.getElementById('report-modal').style.display = "flex";
      },
      submitReport: async () => {
        const reason = document.getElementById('report-reason').value;
        if(!app.currentListing) return;
        await addDoc(collection(db, "reports"), {
            listingId: app.currentListing.id,
            reason: reason,
            reportedBy: app.user ? app.user.uid : 'anonymous',
            createdAt: new Date()
        });
        app.showToast(app.t('toast_published')); // "Published" is close enough to "Reported" for MVP
        app.closeModal('report-modal');
      },
      contactSeller: (method) => {
        if(!app.currentSeller) return;

        // Phone contact is restricted to registered users (require login)
        if(!app.user) { app.showToast(app.t('guest_desc')); return; }

        const phone = app.currentSeller.phone;
        const privacy = app.currentSeller.privacy || "registered";

        if(privacy === "hidden") { app.showToast(app.t('msg_hidden_phone')); return; }
        if(!phone) { app.showToast(app.t('msg_no_phone')); return; }

        if(method === 'call') window.open(`tel:${phone}`);
        if(method === 'whatsapp') {
            const clean = phone.replace(/[^0-9]/g, '');
            window.open(`https://wa.me/${clean}`);
        }
      },


      // --- LISTINGS ---
      triggerUpload: (index) => { app.uploadSlot = index; document.getElementById('upload-input').click(); },
      handleFileSelect: (event) => {
        const file = event.target.files[0]; if (!file) return;
        const reader = new FileReader(); reader.readAsDataURL(file);
        reader.onload = (e) => {
            const img = new Image(); img.src = e.target.result;
            img.onload = () => {
                const cvs = document.createElement('canvas'); const scale = 800 / img.width; cvs.width = 800; cvs.height = img.height * scale;
                const ctx = cvs.getContext('2d'); ctx.drawImage(img, 0, 0, cvs.width, cvs.height);
                const dataUrl = cvs.toDataURL('image/jpeg', 0.7);
                app.images[app.uploadSlot] = dataUrl;
                document.querySelectorAll('.upload-box')[app.uploadSlot].innerHTML = `<img src="${dataUrl}">`;
            };
        };
      },
      publishListing: async () => {
        if (!app.user) { app.showToast(app.t('guest_desc')); app.openAuth('login'); return; }
        const title = document.getElementById('sell-title').value;
        const price = document.getElementById('sell-price').value;
        if(!title || !price) { app.showToast(app.t('toast_fill_all')); return; }
        try {
          app.showToast(app.t('toast_wait'));
          await addDoc(collection(db, "listings"), {
            title: title, price: price, category: document.getElementById('sell-cat').value,
            subcategory: document.getElementById('sell-sub').value,
            country: document.getElementById('sell-country').value, desc: document.getElementById('sell-desc').value,
            image: app.images[0] || null, uid: app.user.uid, status: 'active', createdAt: new Date()
          });
          app.showToast(app.t('toast_published'));
          document.getElementById('sell-title').value = ""; app.images = [null,null,null,null];
          document.querySelectorAll('.upload-box').forEach(b => { b.innerHTML = "+"; });
          document.querySelector('.upload-box.main').innerHTML = "üì∑";
          app.nav('market'); app.loadListings();
        } catch (e) { app.showToast(app.t('toast_error') + e.message); }
      },
      loadListings: async () => {
        let q = query(collection(db, "listings"), orderBy("createdAt", "desc"), limit(50));
        const country = document.getElementById('filter-country').value;
        if(country && country !== "all") { try { q = query(collection(db, "listings"), where("country", "==", country), orderBy("createdAt", "desc")); } catch(e){} }
        
        const snapshot = await getDocs(q);
        const container = document.getElementById('market-listings');
        if (snapshot.empty) { container.innerHTML = `<div class="empty-state"><div class="empty-icon">üõí</div><div>${app.t('empty_results')}</div></div>`; return; }
        let html = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          const isFav = app.userData.favorites && app.userData.favorites.includes(doc.id);
          const imgHtml = data.image ? `<img src="${data.image}">` : `<div style="display:flex;align-items:center;justify-content:center;height:100%;font-size:30px;">üì∑</div>`;
          
          let badges = "";
          if(data.status === 'sold') badges = `<div class="status-badge sold">${app.t('lbl_sold')}</div>`;
          else if(data.status === 'reserved') badges = `<div class="status-badge reserved">${app.t('lbl_reserved')}</div>`;
          
          const overlay = data.status === 'sold' ? `<div class="card-overlay" style="display:flex">${app.t('lbl_sold')}</div>` : '';
          const opacity = data.status === 'sold' ? '0.6' : '1';

          html += `
            <div class="rai-card" style="padding:0; cursor:pointer; opacity:${opacity}" onclick="app.openDetail('${doc.id}')">
              <div style="height:180px; background:var(--bg-input); position:relative;">
                ${imgHtml}
                <div class="card-badges">${badges}</div>
                <div class="fav-btn ${isFav?'active':''}" onclick="app.toggleFav(event, '${doc.id}')">${isFav?'‚ô•':'‚ô°'}</div>
                <div class="card-location">üìç ${data.country || "Balkan"}</div>
                ${overlay}
              </div>
              <div style="padding:15px;">
                <div style="font-weight:700; font-size:16px; margin-bottom:4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${data.title}</div>
                <div style="color:var(--accent); font-weight:700;">‚Ç¨ ${data.price}</div>
              </div>
            </div>`;
        });
        container.innerHTML = html;
      },

      // --- NAV & CONFIG ---
      nav: (view) => {
        window.scrollTo(0,0);
        ['market', 'sell', 'profile'].forEach(v => { document.getElementById('view-' + v).classList.add('hidden'); document.getElementById('tab-' + v).classList.remove('active'); });
        document.getElementById('view-' + view).classList.remove('hidden'); document.getElementById('tab-' + view).classList.add('active');
        if(view === 'profile' && app.user) app.loadProfileData();
            app.applyRegisteredOnlyVisibility();
      },
      showToast: (text) => {
        const c = document.getElementById('toast-container'); const el = document.createElement('div'); el.className = 'toast show'; el.innerText = text; c.appendChild(el);
        setTimeout(() => { el.classList.remove('show'); setTimeout(() => el.remove(), 300); }, 3000);
      },
      
      bindLegalLinks: () => {
        // any element with data-i18n lnk_impressum / lnk_privacy will open the modals
        document.querySelectorAll('[data-i18n="lnk_impressum"]').forEach(a => {
          a.addEventListener('click', (e) => { e.preventDefault(); app.openLegal('imprint'); });
        });
        document.querySelectorAll('[data-i18n="lnk_privacy"]').forEach(a => {
          a.addEventListener('click', (e) => { e.preventDefault(); app.openLegal('privacy'); });
        });
      },

      setLanguage: (langCode) => { app.lang = langCode; app.translatePage(); app.populateDropdowns('filter'); app.populateDropdowns('sell'); },
      translatePage: () => {
        const t = TRANSLATIONS[app.lang];
        document.querySelectorAll('[data-i18n]').forEach(el => { if (t[el.getAttribute('data-i18n')]) el.innerHTML = t[el.getAttribute('data-i18n')]; });
        document.querySelectorAll('[data-i18n-placeholder]').forEach(el => { if (t[el.getAttribute('data-i18n-placeholder')]) el.placeholder = t[el.getAttribute('data-i18n-placeholder')]; });
      },
      setupListeners: () => {
        const catSel = document.getElementById('filter-cat'); const subSel = document.getElementById('filter-sub');
        catSel.addEventListener('change', () => { 
           subSel.disabled = false; subSel.innerHTML = `<option>${app.t('opt_all')}</option>`; 
           if(CATEGORIES_DATA[catSel.value]) CATEGORIES_DATA[catSel.value].subs.forEach(s => { const o = document.createElement('option'); o.value = s.k; o.textContent = s[app.lang] || s['de']; subSel.appendChild(o); });
           app.renderContextFilters('filter', catSel.value, null);
        });
        subSel.addEventListener('change', () => app.renderContextFilters('filter', catSel.value, subSel.value));
        
        const sellCat = document.getElementById('sell-cat'); const sellSub = document.getElementById('sell-sub');
        sellCat.addEventListener('change', () => {
           sellSub.disabled = false; sellSub.innerHTML = `<option>${app.t('opt_choose')}</option>`;
           if(CATEGORIES_DATA[sellCat.value]) CATEGORIES_DATA[sellCat.value].subs.forEach(s => { const o = document.createElement('option'); o.value = s.k; o.textContent = s[app.lang] || s['de']; sellSub.appendChild(o); });
           app.renderContextFilters('sell', sellCat.value, null);
        });
        sellSub.addEventListener('change', () => app.renderContextFilters('sell', sellCat.value, sellSub.value));
      },
      populateDropdowns: (prefix) => {
        const lang = app.lang;
        const countrySel = document.getElementById(prefix + '-country'); countrySel.innerHTML = "";
        for (const code in COUNTRIES_DATA) { const opt = document.createElement('option'); opt.value = code; opt.textContent = COUNTRIES_DATA[code][lang] || COUNTRIES_DATA[code]['en']; countrySel.appendChild(opt); }
        const catSel = document.getElementById(prefix + '-cat'); const prev = catSel.value; catSel.innerHTML = "";
        const def = document.createElement('option'); def.value = ""; def.textContent = prefix==='filter'?app.t('opt_all'):app.t('opt_choose'); catSel.appendChild(def);
        for (const catKey in CATEGORIES_DATA) { const opt = document.createElement('option'); opt.value = catKey; opt.textContent = CATEGORIES_DATA[catKey].label[lang] || CATEGORIES_DATA[catKey].label['de']; catSel.appendChild(opt); }
        catSel.value = prev;
      },
      renderContextFilters: (prefix, categoryKey, subKey) => {
        const container = document.getElementById(prefix === 'filter' ? 'dynamic-filters' : 'sell-dynamic-inputs');
        container.innerHTML = ""; container.style.display = "none"; container.classList.remove('show');
        if (!categoryKey || !CATEGORIES_DATA[categoryKey]) return;
        let filters = [...CATEGORIES_DATA[categoryKey].filters];
        if (categoryKey === 'realestate' && subKey && (subKey.includes('apt') || subKey.includes('house'))) { filters.push({ id: "filter_rooms" }); filters.push({ id: "filter_floor" }); }
        if (filters.length === 0) return;
        container.style.display = prefix === 'filter' ? "block" : "grid";
        if(prefix === 'filter') { setTimeout(() => container.classList.add('show'), 10); container.innerHTML = `<div class="grid-2">${filters.map(f => `<div class="rai-input-group" style="margin:0"><label class="rai-label">${app.t(f.id)}</label><input type="number" class="rai-input" placeholder="0"></div>`).join('')}</div>`; }
        else { container.innerHTML = filters.map(f => `<div class="rai-input-group"><label class="rai-label">${app.t(f.id)}</label><input type="number" class="rai-input" placeholder="0"></div>`).join(''); }
      },
      loadTheme: () => { const saved = localStorage.getItem('theme') || 'light'; document.documentElement.setAttribute('data-theme', saved); document.getElementById('theme-icon').textContent = saved === 'dark' ? '‚òÄÔ∏è' : 'üåô'; },
      toggleTheme: () => { const current = document.documentElement.getAttribute('data-theme'); const next = current === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', next); localStorage.setItem('theme', next); document.getElementById('theme-icon').textContent = next === 'dark' ? '‚òÄÔ∏è' : 'üåô'; }
    };

    document.getElementById('btn-auth-switch').addEventListener('click', () => { app.openAuth(app.authMode === 'login' ? 'register' : 'login'); });
    document.getElementById('btn-auth-action').addEventListener('click', app.handleAuth);

    app.init();
  </script>
</body>
</html>
